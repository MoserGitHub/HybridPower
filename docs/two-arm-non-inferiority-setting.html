<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Two-arm non-inferiority setting | Frequentist, Bayesian and hybrid approaches for sample size and power calculations</title>
  <meta name="description" content="Chapter 2 Two-arm non-inferiority setting | Frequentist, Bayesian and hybrid approaches for sample size and power calculations" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Two-arm non-inferiority setting | Frequentist, Bayesian and hybrid approaches for sample size and power calculations" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Two-arm non-inferiority setting | Frequentist, Bayesian and hybrid approaches for sample size and power calculations" />
  
  
  

<meta name="author" content="André Moser, CTU Bern, University of Bern" />


<meta name="date" content="2023-04-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Background</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#general-notation-and-abbreviations"><i class="fa fa-check"></i><b>1.1</b> General notation and abbreviations</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#power-vocabulary"><i class="fa fa-check"></i><b>1.2</b> ‘Power’ vocabulary</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#some-bayesian-concepts"><i class="fa fa-check"></i><b>1.3</b> Some ‘Bayesian’ concepts</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html"><i class="fa fa-check"></i><b>2</b> Two-arm non-inferiority setting</a>
<ul>
<li class="chapter" data-level="2.1" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#binomial-outcome"><i class="fa fa-check"></i><b>2.1</b> Binomial outcome</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#frequentist-approach"><i class="fa fa-check"></i><b>2.1.1</b> Frequentist approach</a></li>
<li class="chapter" data-level="2.1.2" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#hybrid-approach-prior-on-treatment-effect"><i class="fa fa-check"></i><b>2.1.2</b> Hybrid approach: Prior on treatment effect</a></li>
<li class="chapter" data-level="2.1.3" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#proper-bayesian-approach"><i class="fa fa-check"></i><b>2.1.3</b> Proper Bayesian approach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Frequentist, Bayesian and hybrid approaches for sample size and power calculations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="two-arm-non-inferiority-setting" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Two-arm non-inferiority setting<a href="two-arm-non-inferiority-setting.html#two-arm-non-inferiority-setting" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section we consider a non-inferiority clinical trial setting with a null hypothesis <span class="math inline">\(H_0: \delta &gt; \delta^*\)</span> and alternative hypothesis <span class="math inline">\(H_a: \delta \leq \delta^*\)</span>, where <span class="math inline">\(\delta^*&gt;0\)</span> is a fixed non-inferiority margin and a treatment effect <span class="math inline">\(\delta\)</span>.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<div id="binomial-outcome" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Binomial outcome<a href="two-arm-non-inferiority-setting.html#binomial-outcome" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here <span class="math inline">\(p_i\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>, are event probabilities from two treatment arms. <span class="math inline">\(\delta=p_1-p_0\)</span> is the true treatment effect expressed as a risk difference.</p>
<hr />
<p><strong>Working example</strong></p>
<p>We use the SAFE-SSPE trial as a working example <span class="citation">[<a href="#ref-Baumgartner2020" role="doc-biblioref">3</a>]</span>. In brief, this non-inferiority randomised placebo-controlled trial compares clinical surveillance versus anticoagulant treatment in low-risk patients with isolated subsegmental pulmonary embolism (SSPE). The primary outcome is 3-month recurrence of venous thromboembolism (VTE). The null hypothesis <span class="math inline">\(H_0\)</span> is ‘clinical surveillance is inferior to anticoagulant treatment’ versus the alternative hypothesis <span class="math inline">\(H_a\)</span> ‘clinical surveillance is non-inferior to anticoagulant treatment’. The non-inferiority margin was set at 3.5% and it was assumed that the proportion of VTE in both groups was 1%.</p>
<hr />
<div id="frequentist-approach" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Frequentist approach<a href="two-arm-non-inferiority-setting.html#frequentist-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let <span class="math inline">\(Y_{i,k} \sim^{iid} Bernoulli(p_i)\)</span>, <span class="math inline">\(k=1,\dots,n_i\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>. Let <span class="math inline">\(\overline p_i=\frac{1}{n_i}\sum_{k\leq n_i} Y_{i,k}\)</span>, <span class="math inline">\(i\in {0,1}\)</span>, and thus the estimated risk difference <span class="math inline">\(D=\overline p_1-\overline p_0\)</span> is Gaussian distributed with <span class="math inline">\(D \sim N\left(\delta, \frac{\sigma_1^2}{n_1}+\frac{\sigma_0^2}{n_0}\right)\)</span>, where <span class="math inline">\(\sigma_i^2=p_i(1-p_i)\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>. For notational purposes we denote <span class="math inline">\(\sigma_{treat}^2=\frac{\sigma_1^2}{n_1}+\frac{\sigma_0^2}{n_0}\)</span>, that is, the variance for the estimated treatment effect.</p>
<p>We are interested whether the upper <span class="math inline">\((1-\alpha)\%\)</span>-confidence limit is smaller than the non-inferiority margin, that is,
<span class="math display">\[
D+z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}\leq \delta^*,
\]</span>
where <span class="math inline">\(z_{1-\alpha}=\Phi^{-1}(1-\alpha)\)</span>. Simple algebra leads to
<span class="math display">\[
D\leq -z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*.
\]</span>
Note that <span class="math inline">\(D_{suc}^{\delta^*}:=-z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*\)</span> is the required risk difference for a ‘successful’ rejection of the null hypothesis. Then
<span class="math display">\[
\begin{aligned}
P_\delta(D\leq D_{suc}^{\delta^*})&amp;=\Phi\left(-z_{1-\alpha}-\sqrt{\frac{n_1n_0}{n_0\sigma_1^2+n_1\sigma_0^2}}(\delta-\delta^*)\right) \\
&amp;=\Phi\left(-z_{1-\alpha}-\frac{(\delta-\delta^*)}{\sigma_{treat}}\right),
\end{aligned}
\]</span>
since under regularity conditions,
<span class="math display">\[
Z=\frac{D-\delta^*}{\sigma_{treat}} \rightarrow N(0,1), \quad \min(n_1,n_0) \rightarrow \infty.
\]</span>
<span class="math inline">\(P_{\delta}(D\leq D_{suc}^{\delta^*})\)</span> is the <strong>‘probability of rejection given <span class="math inline">\(\delta\)</span>’</strong>. Under the null value <span class="math inline">\(\delta_0=p_1-p_0\)</span>, <span class="math inline">\(P_{\delta_0}(D\leq D_{suc}^{\delta^*})=\alpha\)</span> is the ‘type-I error’ and under an alternative value <span class="math inline">\(\delta_A\)</span>, <span class="math inline">\(P_{\delta_A}(D\leq D_{suc}^{\delta^*})=1-\beta\)</span> is the ‘frequentist power’.</p>
<p>For an alternative value <span class="math inline">\(\delta_A\)</span> it holds that</p>
<p><span class="math display">\[
-z_{1-\alpha}-\sqrt{\frac{n_1n_0}{n_0\sigma_1^2+n_1\sigma_0^2}}(\delta_A-\delta^*)=\Phi^{-1}(1-\beta)=z_{1-\beta}
\]</span>
and so the sample size can then be derived as
<span class="math display">\[
\frac{(z_{1-\beta}+z_{1-\alpha})^2}{(\delta_A-\delta^*)^2}=\frac{an_0^2}{n_0\sigma_1^2+an_0\sigma_0^2},
\]</span>
where <span class="math inline">\(a=n_1/n_0\)</span> is an allocation ratio, such that
<span class="math display">\[
n_0=(z_{1-\beta}+z_{1-\alpha})^2\frac{\sigma_1^2+a\sigma_0^2}{a(\delta_A-\delta^*)^2}, \quad n_1=an_0.
\]</span></p>
<p><span class="math inline">\(\delta_0\)</span>, <span class="math inline">\(\delta_A\)</span> and <span class="math inline">\(\delta^*\)</span> are assumed as fixed and known constants in a frequentist approach. Their choices are of high importance, because all trial conclusions are based on those choices and affect the sample size calculation. The plot below shows how the sample size increase as <span class="math inline">\(\delta^*\)</span> approaches <span class="math inline">\(\delta\)</span>.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<hr />
<p><strong>Working example (continued)</strong></p>
<p>We calculate the required sample size for the SAFE-SSPE trial under the following parameters:</p>
<ul>
<li><span class="math inline">\(p_1=0.01\)</span>, <span class="math inline">\(p_0=0.01\)</span>, <span class="math inline">\(\delta^*=0.035\)</span>, <span class="math inline">\(1-\beta=0.8\)</span>, <span class="math inline">\(\alpha=0.05\)</span>, <span class="math inline">\(a=1/1\)</span></li>
</ul>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="two-arm-non-inferiority-setting.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epiR)</span>
<span id="cb1-2"><a href="two-arm-non-inferiority-setting.html#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="two-arm-non-inferiority-setting.html#cb1-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb1-4"><a href="two-arm-non-inferiority-setting.html#cb1-4" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb1-5"><a href="two-arm-non-inferiority-setting.html#cb1-5" aria-hidden="true" tabindex="-1"></a>p_0 <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb1-6"><a href="two-arm-non-inferiority-setting.html#cb1-6" aria-hidden="true" tabindex="-1"></a>p_1 <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb1-7"><a href="two-arm-non-inferiority-setting.html#cb1-7" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> p_1<span class="sc">-</span>p_0</span>
<span id="cb1-8"><a href="two-arm-non-inferiority-setting.html#cb1-8" aria-hidden="true" tabindex="-1"></a>delta_star <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb1-9"><a href="two-arm-non-inferiority-setting.html#cb1-9" aria-hidden="true" tabindex="-1"></a>sd_0 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p_0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p_0))</span>
<span id="cb1-10"><a href="two-arm-non-inferiority-setting.html#cb1-10" aria-hidden="true" tabindex="-1"></a>sd_1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p_1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p_1))</span>
<span id="cb1-11"><a href="two-arm-non-inferiority-setting.html#cb1-11" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1</span></span>
<span id="cb1-12"><a href="two-arm-non-inferiority-setting.html#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="two-arm-non-inferiority-setting.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">epi.ssninfb</span>(<span class="at">treat=</span>p_1, <span class="at">control=</span>p_0, <span class="at">delta=</span>delta_star, <span class="at">power=</span><span class="dv">1</span><span class="sc">-</span>beta, <span class="at">r=</span>a, <span class="at">alpha=</span>alpha, <span class="at">n=</span><span class="cn">NA</span>)</span></code></pre></div>
</details>
<pre><code>## $n.total
## [1] 200
## 
## $n.treat
## [1] 100
## 
## $n.control
## [1] 100
## 
## $delta
## [1] 0.035
## 
## $power
## [1] 0.8</code></pre>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="two-arm-non-inferiority-setting.html#cb3-1" aria-hidden="true" tabindex="-1"></a>n_0 <span class="ot">&lt;-</span> ((<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>beta)<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha))<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>((sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>a<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(a<span class="sc">*</span>(delta<span class="sc">-</span>delta_star)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb3-2"><a href="two-arm-non-inferiority-setting.html#cb3-2" aria-hidden="true" tabindex="-1"></a>n_0</span></code></pre></div>
</details>
<pre><code>## [1] 99.93031</code></pre>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="two-arm-non-inferiority-setting.html#cb5-1" aria-hidden="true" tabindex="-1"></a>n_1 <span class="ot">&lt;-</span> n_0<span class="sc">*</span>a</span>
<span id="cb5-2"><a href="two-arm-non-inferiority-setting.html#cb5-2" aria-hidden="true" tabindex="-1"></a>n_1</span></code></pre></div>
</details>
<pre><code>## [1] 99.93031</code></pre>
<p>Given the specified operating characteristics and parameters a sample size of 200 patients (100 per arm) is needed to reject the null hypothesis of inferiority. This is more or less the sample size mentioned in the study protocol of the SAFE-SSPE trial but without dropouts and adjustments for rare events.</p>
</div>
<div id="hybrid-approach-prior-on-treatment-effect" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Hybrid approach: Prior on treatment effect<a href="two-arm-non-inferiority-setting.html#hybrid-approach-prior-on-treatment-effect" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose that the true treatment effect <span class="math inline">\(\delta\)</span> is a realization from a random variable <span class="math inline">\(\Delta\)</span> with <span class="math inline">\(p(\delta)\)</span>. In this subsection we assume that the prior comes from a Gaussian distribution function so that <span class="math inline">\(\Delta \sim N\left(d, \frac{\sigma_1^2+\sigma_0^2}{m}\right)\)</span>. Note that this prior can be thought as a realisation from <span class="math inline">\(m\)</span> Gaussian ‘prior observations’ with variance <span class="math inline">\(\sigma_1^2+\sigma_0^2\)</span>. Again for notational purposes we denote <span class="math inline">\(\sigma_{prior}^2=\frac{\sigma_1^2+\sigma_0^2}{m}\)</span> as the variance of the design prior on the treatment effect.</p>
<p>In the following we will use the following priors:</p>
<ul>
<li><strong>Enthusiastic prior</strong> (favors non-inferiority): <span class="math inline">\(d=0\)</span>, <span class="math inline">\(m=6.6\)</span>, <span class="math inline">\(P(\Delta&gt;\delta^*)=0.05\)</span>. This prior is centered on the treatment effect such that there is a low probability (here 5%) of inferiority.</li>
<li><strong>Skeptical prior</strong> (favors inferiority): <span class="math inline">\(d=\delta^*\)</span>, <span class="math inline">\(m=6.6\)</span>, <span class="math inline">\(P(\Delta&gt;0)=0.05\)</span>. This prior is centered on the non-inferiority margin such that there is a low probability (here 5%) of superiority.</li>
<li><strong>Informative prior</strong> (clinical expert knowledge): <span class="math inline">\(d=0\)</span> with <span class="math inline">\(m=25\)</span>.</li>
<li><strong>Noninformative prior</strong>: <span class="math inline">\(d=0\)</span> with <span class="math inline">\(m=0.5\)</span>.</li>
</ul>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Let
<span class="math display">\[
AP:=\int_{\Delta} P_{\delta}(D\leq D_{suc}^{\delta^*})p(\delta)d\delta,
\]</span></p>
<p>be the <strong>‘average power’</strong> <span class="citation">[<a href="#ref-Grieve2022" role="doc-biblioref">4</a>]</span> (also called ‘assurance’ <span class="citation">[<a href="#ref-OHagan2005" role="doc-biblioref">5</a>]</span>, ‘probability of success’ <span class="citation">[<a href="#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span>, <span class="citation">[<a href="#ref-Spiegelhalter2003" role="doc-biblioref">2</a>]</span> or Bayesian predictive power <span class="citation">[<a href="#ref-Rufibach2016" role="doc-biblioref">6</a>]</span>. The supplemental section of <span class="citation">[<a href="#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span> contains a literature review of the used terminology). Remember that in an hybrid approach we are interested in trial conclusions from a frequentist point of view, thus we are interested in</p>
<p><span class="math display">\[
D\leq -z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*.
\]</span>
By using a design prior we take into account the uncertainty of the treatment effect. The prior predictive distribution for an estimated risk difference, say <span class="math inline">\(\tilde D\)</span>, with a prior <span class="math inline">\(\Delta \sim N\left(d, \sigma_{prior}^2\right)\)</span> includes this uncertainty. For the Gaussian case, the prior predictive distribution of <span class="math inline">\(\tilde D\)</span> is given as
<span class="math display">\[
\tilde D \sim N\left(d, \sigma_{treat}^2+\sigma_{prior}^2\right),
\]</span>
since <span class="math inline">\(\tilde D \sim N\left(\delta, \sigma_{treat}^2\right)\)</span>.</p>
<p>Suppose now that <span class="math inline">\(D\)</span> has a predictive distribution as described above, then
<span class="math display">\[
\begin{aligned}
AP&amp;=\int_{-\infty}^{-z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*}f(\tilde\delta)d\tilde\delta= \Phi\left(\frac{1}{\sigma_{prior}}\left[-z_{1-\alpha}\sigma_{treat}-(d-\delta^*)\right]\right)
\end{aligned}
\]</span>
see for example <span class="citation">[<a href="#ref-Grieve2022" role="doc-biblioref">4</a>]</span>. Note that as <span class="math inline">\(m \rightarrow \infty\)</span>, then <span class="math inline">\(AP \rightarrow \Phi\left(-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}\right)\)</span>, that is, the frequentist power at <span class="math inline">\(d\)</span>.</p>
<hr />
<p><strong>Working example (continued) </strong></p>
<p>We calculate the AP under the assumed prior distributions and parameters for the SAFE-SSPE trial.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="two-arm-non-inferiority-setting.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb7-2"><a href="two-arm-non-inferiority-setting.html#cb7-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb7-3"><a href="two-arm-non-inferiority-setting.html#cb7-3" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-4"><a href="two-arm-non-inferiority-setting.html#cb7-4" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb7-5"><a href="two-arm-non-inferiority-setting.html#cb7-5" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb7-6"><a href="two-arm-non-inferiority-setting.html#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="two-arm-non-inferiority-setting.html#cb7-7" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb7-8"><a href="two-arm-non-inferiority-setting.html#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="two-arm-non-inferiority-setting.html#cb7-9" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Enthusiastic&quot;</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP,<span class="dv">2</span>))</span>
<span id="cb7-10"><a href="two-arm-non-inferiority-setting.html#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="two-arm-non-inferiority-setting.html#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb7-12"><a href="two-arm-non-inferiority-setting.html#cb7-12" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb7-13"><a href="two-arm-non-inferiority-setting.html#cb7-13" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb7-14"><a href="two-arm-non-inferiority-setting.html#cb7-14" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb7-15"><a href="two-arm-non-inferiority-setting.html#cb7-15" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb7-16"><a href="two-arm-non-inferiority-setting.html#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="two-arm-non-inferiority-setting.html#cb7-17" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb7-18"><a href="two-arm-non-inferiority-setting.html#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="two-arm-non-inferiority-setting.html#cb7-19" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Skeptical&quot;</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP,<span class="dv">2</span>)))</span>
<span id="cb7-20"><a href="two-arm-non-inferiority-setting.html#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="two-arm-non-inferiority-setting.html#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb7-22"><a href="two-arm-non-inferiority-setting.html#cb7-22" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb7-23"><a href="two-arm-non-inferiority-setting.html#cb7-23" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-24"><a href="two-arm-non-inferiority-setting.html#cb7-24" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb7-25"><a href="two-arm-non-inferiority-setting.html#cb7-25" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb7-26"><a href="two-arm-non-inferiority-setting.html#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="two-arm-non-inferiority-setting.html#cb7-27" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb7-28"><a href="two-arm-non-inferiority-setting.html#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="two-arm-non-inferiority-setting.html#cb7-29" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Informative&quot;</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP,<span class="dv">2</span>)))</span>
<span id="cb7-30"><a href="two-arm-non-inferiority-setting.html#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="two-arm-non-inferiority-setting.html#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb7-32"><a href="two-arm-non-inferiority-setting.html#cb7-32" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb7-33"><a href="two-arm-non-inferiority-setting.html#cb7-33" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-34"><a href="two-arm-non-inferiority-setting.html#cb7-34" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb7-35"><a href="two-arm-non-inferiority-setting.html#cb7-35" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb7-36"><a href="two-arm-non-inferiority-setting.html#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="two-arm-non-inferiority-setting.html#cb7-37" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb7-38"><a href="two-arm-non-inferiority-setting.html#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="two-arm-non-inferiority-setting.html#cb7-39" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Noninformative&quot;</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP,<span class="dv">2</span>)))</span>
<span id="cb7-40"><a href="two-arm-non-inferiority-setting.html#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="two-arm-non-inferiority-setting.html#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(data_output <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(type))</span></code></pre></div>
</details>
<pre><code>##             type      n_0      n_1   AP
## 1   Enthusiastic 99.93031 99.93031 0.59
## 2    Informative 99.93031 99.93031 0.66
## 3 Noninformative 99.93031 99.93031 0.52
## 4      Skeptical 99.93031 99.93031 0.34</code></pre>
<p>Under an ‘enthusiastic prior’ we get an average power of 59%. For an ‘skeptical prior’ the average power decreases to 34%. These values are lower than the frequentist power of 80%.</p>
<hr />
<p>Rufibach et al. give a closed a formula for the distribution of <span class="math inline">\(RPR:=P_\Delta(D\leq D_{suc}^{\delta^*})\)</span>, where <span class="math inline">\(\Delta \sim N(d,\sigma^2_{prior})\)</span>, and discuss the shape under different prior choices <span class="citation">[<a href="#ref-Rufibach2016" role="doc-biblioref">6</a>]</span>. In the following we use the wording ’random probability to reject` (RPR) similar to <span class="citation">[<a href="#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span>.</p>
<p>For <span class="math inline">\(0&lt;y&lt;1\)</span>, the random variable <span class="math inline">\(RPR\)</span> has a probability density function
<span class="math display">\[
\begin{aligned}
f(y)&amp;=\frac{\sigma_{treat}}{\sigma_{prior}} \phi\left(-z_{1-\alpha}\frac{\sigma_{treat}}{\sigma_{prior}}-\frac{(d-\delta^*)}{\sigma_{prior}}-\frac{\sigma_{treat}}{\sigma_{prior}}\Phi^{-1}(y) \right)\left[ \phi\left(\Phi^{-1}(y) \right) \right]^{-1},
\end{aligned}
\]</span>
see <span class="citation">[<a href="#ref-Rufibach2016" role="doc-biblioref">6</a>]</span>.</p>
<hr />
<p><strong>Special case</strong></p>
<p>For the case that <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to</p>
<p><span class="math display">\[
\begin{aligned}
f(y)&amp;=\sqrt{\frac{m}{n}}\phi\left(\sqrt{\frac{m}{n}}\left[-z_{1-\alpha}-\sqrt{\frac{n}{2\sigma^2}}(d-\delta^*)-\Phi^{-1}(y)\right] \right)\left[ \phi\left(\Phi^{-1}(y) \right) \right]^{-1}, \quad 0&lt;y&lt;1.
\end{aligned}
\]</span></p>
<hr />
<hr />
<p><strong>Working example (continued) </strong></p>
<p>We derive the probability densities for the different assumed priors for the SAFE-SSPE study.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="two-arm-non-inferiority-setting.html#cb9-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.001</span>,<span class="fl">0.999</span>,<span class="fl">0.001</span>)</span>
<span id="cb9-2"><a href="two-arm-non-inferiority-setting.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="two-arm-non-inferiority-setting.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb9-4"><a href="two-arm-non-inferiority-setting.html#cb9-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb9-5"><a href="two-arm-non-inferiority-setting.html#cb9-5" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-6"><a href="two-arm-non-inferiority-setting.html#cb9-6" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb9-7"><a href="two-arm-non-inferiority-setting.html#cb9-7" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb9-8"><a href="two-arm-non-inferiority-setting.html#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="two-arm-non-inferiority-setting.html#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Rufibach 2016: formula (4)</span></span>
<span id="cb9-10"><a href="two-arm-non-inferiority-setting.html#cb9-10" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(m<span class="sc">*</span>n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>m<span class="sc">*</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span><span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">sqrt</span>(m<span class="sc">*</span>n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>m<span class="sc">*</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span><span class="fu">sqrt</span>(m)<span class="sc">/</span><span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span><span class="fu">sqrt</span>(m<span class="sc">*</span>n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>m<span class="sc">*</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span><span class="fu">qnorm</span>(x))<span class="sc">*</span>(<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb9-11"><a href="two-arm-non-inferiority-setting.html#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="two-arm-non-inferiority-setting.html#cb9-12" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, y, <span class="at">type=</span><span class="st">&quot;Enthusiastic&quot;</span>)</span>
<span id="cb9-13"><a href="two-arm-non-inferiority-setting.html#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="two-arm-non-inferiority-setting.html#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb9-15"><a href="two-arm-non-inferiority-setting.html#cb9-15" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb9-16"><a href="two-arm-non-inferiority-setting.html#cb9-16" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb9-17"><a href="two-arm-non-inferiority-setting.html#cb9-17" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb9-18"><a href="two-arm-non-inferiority-setting.html#cb9-18" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb9-19"><a href="two-arm-non-inferiority-setting.html#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="two-arm-non-inferiority-setting.html#cb9-20" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">*</span><span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span>(sigma_treat<span class="sc">/</span>sigma_prior)<span class="sc">*</span><span class="fu">qnorm</span>(x))<span class="sc">*</span>(<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb9-21"><a href="two-arm-non-inferiority-setting.html#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="two-arm-non-inferiority-setting.html#cb9-22" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(x, y, <span class="at">type=</span><span class="st">&quot;Skeptical&quot;</span>))</span>
<span id="cb9-23"><a href="two-arm-non-inferiority-setting.html#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="two-arm-non-inferiority-setting.html#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb9-25"><a href="two-arm-non-inferiority-setting.html#cb9-25" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb9-26"><a href="two-arm-non-inferiority-setting.html#cb9-26" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-27"><a href="two-arm-non-inferiority-setting.html#cb9-27" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb9-28"><a href="two-arm-non-inferiority-setting.html#cb9-28" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb9-29"><a href="two-arm-non-inferiority-setting.html#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="two-arm-non-inferiority-setting.html#cb9-30" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">*</span><span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span>(sigma_treat<span class="sc">/</span>sigma_prior)<span class="sc">*</span><span class="fu">qnorm</span>(x))<span class="sc">*</span>(<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb9-31"><a href="two-arm-non-inferiority-setting.html#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="two-arm-non-inferiority-setting.html#cb9-32" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(x, y, <span class="at">type=</span><span class="st">&quot;Informative&quot;</span>))</span>
<span id="cb9-33"><a href="two-arm-non-inferiority-setting.html#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="two-arm-non-inferiority-setting.html#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb9-35"><a href="two-arm-non-inferiority-setting.html#cb9-35" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb9-36"><a href="two-arm-non-inferiority-setting.html#cb9-36" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-37"><a href="two-arm-non-inferiority-setting.html#cb9-37" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb9-38"><a href="two-arm-non-inferiority-setting.html#cb9-38" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb9-39"><a href="two-arm-non-inferiority-setting.html#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="two-arm-non-inferiority-setting.html#cb9-40" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">*</span><span class="fu">dnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span>(sigma_treat<span class="sc">/</span>sigma_prior)<span class="sc">*</span><span class="fu">qnorm</span>(x))<span class="sc">*</span>(<span class="fu">dnorm</span>(<span class="fu">qnorm</span>(x)))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb9-41"><a href="two-arm-non-inferiority-setting.html#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="two-arm-non-inferiority-setting.html#cb9-42" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(x, y, <span class="at">type=</span><span class="st">&quot;Noninformative&quot;</span>))</span>
<span id="cb9-43"><a href="two-arm-non-inferiority-setting.html#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="two-arm-non-inferiority-setting.html#cb9-44" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> data_output <span class="sc">%&gt;%</span> <span class="fu">select</span>(type, <span class="at">x=</span>AP) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">y=</span><span class="dv">0</span>)</span>
<span id="cb9-45"><a href="two-arm-non-inferiority-setting.html#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="two-arm-non-inferiority-setting.html#cb9-46" aria-hidden="true" tabindex="-1"></a>data_power<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_power<span class="sc">$</span>type, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;Enthusiastic&quot;</span>, <span class="st">&quot;Skeptical&quot;</span>, <span class="st">&quot;Informative&quot;</span>, <span class="st">&quot;Noninformative&quot;</span>))</span>
<span id="cb9-47"><a href="two-arm-non-inferiority-setting.html#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="two-arm-non-inferiority-setting.html#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_power, <span class="fu">aes</span>(x, y, <span class="at">colour=</span>type))<span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>)<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">data=</span>data_output2, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">colour=</span>type))<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="st">&quot;Prior type&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;purple&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;darkred&quot;</span>))<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Density&quot;</span>)<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;RPR&quot;</span>)<span class="sc">+</span><span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>))<span class="sc">+</span><span class="fu">labs</span>(<span class="at">caption=</span><span class="st">&quot;Dots indicate the AP.&quot;</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<hr />
<p>The cumulative distribution function of <span class="math inline">\(RPR\)</span> can the be calculated as</p>
<p><span class="math display">\[
\begin{aligned}
P(RPR\leq y)=1-\Phi&amp;\left(\frac{\sigma_{treat}}{\sigma_{prior}}\left[-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}-\Phi^{-1}(y) \right]\right), \quad 0&lt;y&lt;1.
\end{aligned}
\]</span></p>
<hr />
<p><strong>Special case</strong></p>
<p>For the case that <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to</p>
<p><span class="math display">\[
\begin{aligned}
P(RPR\leq y)=1-\Phi&amp;\left(\frac{\sigma_{treat}}{\sigma_{prior}}\left[-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}-\Phi^{-1}(y) \right] \right), \quad 0&lt;y&lt;1.
\end{aligned}
\]</span></p>
<hr />
<p>Note that if <span class="math inline">\(n_0\)</span> and <span class="math inline">\(n_1\)</span> are the planned treatment arm sample sizes from a frequentist power calculation as described in <a href="#id_##-frequentist-approach">Section 2.1.1</a> above, then, if <span class="math inline">\(d=\delta_A\)</span>,
<span class="math display">\[
-z_{1-\alpha}-\frac{(d-\delta^*)}{\sigma_{treat}}=\Phi^{-1}(y)=\Phi^{-1}(1-\beta) \quad \Rightarrow \quad P(RPR\leq y)=0.5, \quad y=1-\beta.
\]</span></p>
<hr />
<p><strong>Working example (continued) </strong></p>
<p>With the above formula we calculate the probability <span class="math inline">\(P(RPR&gt;\gamma)\)</span>, <span class="math inline">\(0&lt;\gamma&lt;1\)</span>, for the SAFE-SSPE study. We use an enthusiastic (<span class="math inline">\(m=6.6\)</span>), an informative (<span class="math inline">\(m=25\)</span>) and a noninformative prior (<span class="math inline">\(m=0.5\)</span>) prior, all centered on <span class="math inline">\(\delta=0\)</span>.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="two-arm-non-inferiority-setting.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gamma range</span></span>
<span id="cb10-2"><a href="two-arm-non-inferiority-setting.html#cb10-2" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">0.99</span>,<span class="fl">0.01</span>)</span>
<span id="cb10-3"><a href="two-arm-non-inferiority-setting.html#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="two-arm-non-inferiority-setting.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on p1-p0</span></span>
<span id="cb10-5"><a href="two-arm-non-inferiority-setting.html#cb10-5" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-6"><a href="two-arm-non-inferiority-setting.html#cb10-6" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">6.6</span>, <span class="dv">25</span>)</span>
<span id="cb10-7"><a href="two-arm-non-inferiority-setting.html#cb10-7" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> n_0</span>
<span id="cb10-8"><a href="two-arm-non-inferiority-setting.html#cb10-8" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(gamma, m_range, n_0_range)</span>
<span id="cb10-9"><a href="two-arm-non-inferiority-setting.html#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;m_range&quot;</span>, <span class="st">&quot;n_0_range&quot;</span>)</span>
<span id="cb10-10"><a href="two-arm-non-inferiority-setting.html#cb10-10" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a<span class="sc">*</span>data_rpr<span class="sc">$</span>n_0_range</span>
<span id="cb10-11"><a href="two-arm-non-inferiority-setting.html#cb10-11" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_0_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_1_range)</span>
<span id="cb10-12"><a href="two-arm-non-inferiority-setting.html#cb10-12" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range)</span>
<span id="cb10-13"><a href="two-arm-non-inferiority-setting.html#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="two-arm-non-inferiority-setting.html#cb10-14" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>data_rpr<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span>(data_rpr<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior)<span class="sc">*</span><span class="fu">qnorm</span>(data_rpr<span class="sc">$</span>gamma))</span>
<span id="cb10-15"><a href="two-arm-non-inferiority-setting.html#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="two-arm-non-inferiority-setting.html#cb10-16" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-17"><a href="two-arm-non-inferiority-setting.html#cb10-17" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Noninformative&quot;</span></span>
<span id="cb10-18"><a href="two-arm-non-inferiority-setting.html#cb10-18" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="fl">6.6</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Enthusiastic&quot;</span></span>
<span id="cb10-19"><a href="two-arm-non-inferiority-setting.html#cb10-19" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Informative&quot;</span></span>
<span id="cb10-20"><a href="two-arm-non-inferiority-setting.html#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="two-arm-non-inferiority-setting.html#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on noninferiority margin</span></span>
<span id="cb10-22"><a href="two-arm-non-inferiority-setting.html#cb10-22" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb10-23"><a href="two-arm-non-inferiority-setting.html#cb10-23" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">6.6</span>)</span>
<span id="cb10-24"><a href="two-arm-non-inferiority-setting.html#cb10-24" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> n_0</span>
<span id="cb10-25"><a href="two-arm-non-inferiority-setting.html#cb10-25" aria-hidden="true" tabindex="-1"></a>data_rpr_skep <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(gamma, m_range, n_0_range)</span>
<span id="cb10-26"><a href="two-arm-non-inferiority-setting.html#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr_skep) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;m_range&quot;</span>, <span class="st">&quot;n_0_range&quot;</span>)</span>
<span id="cb10-27"><a href="two-arm-non-inferiority-setting.html#cb10-27" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a<span class="sc">*</span>data_rpr_skep<span class="sc">$</span>n_0_range</span>
<span id="cb10-28"><a href="two-arm-non-inferiority-setting.html#cb10-28" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_0_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_1_range)</span>
<span id="cb10-29"><a href="two-arm-non-inferiority-setting.html#cb10-29" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range)</span>
<span id="cb10-30"><a href="two-arm-non-inferiority-setting.html#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="two-arm-non-inferiority-setting.html#cb10-31" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>data_rpr_skep<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span>(data_rpr_skep<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior)<span class="sc">*</span><span class="fu">qnorm</span>(data_rpr_skep<span class="sc">$</span>gamma))</span>
<span id="cb10-32"><a href="two-arm-non-inferiority-setting.html#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="two-arm-non-inferiority-setting.html#cb10-33" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">&quot;Skeptical&quot;</span></span>
<span id="cb10-34"><a href="two-arm-non-inferiority-setting.html#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="two-arm-non-inferiority-setting.html#cb10-35" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_rpr, data_rpr_skep)</span>
<span id="cb10-36"><a href="two-arm-non-inferiority-setting.html#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="two-arm-non-inferiority-setting.html#cb10-37" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_rpr<span class="sc">$</span>type, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;Enthusiastic&quot;</span>, <span class="st">&quot;Skeptical&quot;</span>, <span class="st">&quot;Informative&quot;</span>, <span class="st">&quot;Noninformative&quot;</span>))</span>
<span id="cb10-38"><a href="two-arm-non-inferiority-setting.html#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="two-arm-non-inferiority-setting.html#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_rpr, <span class="fu">aes</span>(<span class="at">x=</span>gamma, <span class="at">y=</span>p_rpr, <span class="at">colour=</span>type))<span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="st">&quot;Prior type&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;purple&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;darkred&quot;</span>))<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Threshold gamma&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Probability that RPR is greater than threshold gamma&quot;</span>)<span class="sc">+</span><span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>))<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>))<span class="sc">+</span><span class="fu">labs</span>(<span class="at">caption=</span><span class="fu">str_glue</span>(<span class="st">&quot;Calculated based on a planned total sample size of &quot;</span>, <span class="fu">round</span>(n_0_range<span class="sc">+</span>a<span class="sc">*</span>n_0_range,<span class="dv">0</span>), <span class="st">&quot;.&quot;</span>))</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>For a specific threshold, say <span class="math inline">\(\gamma=0.6\)</span>, and varying ‘prior sample sizes’ <span class="math inline">\(m\)</span> we obtain</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="two-arm-non-inferiority-setting.html#cb11-1" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb11-2"><a href="two-arm-non-inferiority-setting.html#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="two-arm-non-inferiority-setting.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on p1-p0</span></span>
<span id="cb11-4"><a href="two-arm-non-inferiority-setting.html#cb11-4" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-5"><a href="two-arm-non-inferiority-setting.html#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="two-arm-non-inferiority-setting.html#cb11-6" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">6.6</span>, <span class="dv">25</span>)</span>
<span id="cb11-7"><a href="two-arm-non-inferiority-setting.html#cb11-7" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">300</span>, <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb11-8"><a href="two-arm-non-inferiority-setting.html#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="two-arm-non-inferiority-setting.html#cb11-9" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(m_range, n_0_range)</span>
<span id="cb11-10"><a href="two-arm-non-inferiority-setting.html#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;m_range&quot;</span>, <span class="st">&quot;n_0_range&quot;</span>)</span>
<span id="cb11-11"><a href="two-arm-non-inferiority-setting.html#cb11-11" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a<span class="sc">*</span>data_rpr<span class="sc">$</span>n_0_range</span>
<span id="cb11-12"><a href="two-arm-non-inferiority-setting.html#cb11-12" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_0_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>n_1_range)</span>
<span id="cb11-13"><a href="two-arm-non-inferiority-setting.html#cb11-13" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr<span class="sc">$</span>m_range)</span>
<span id="cb11-14"><a href="two-arm-non-inferiority-setting.html#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="two-arm-non-inferiority-setting.html#cb11-15" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(data_rpr<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>data_rpr<span class="sc">$</span>sigma_treat)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span><span class="fu">qnorm</span>(gamma)))</span>
<span id="cb11-16"><a href="two-arm-non-inferiority-setting.html#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="two-arm-non-inferiority-setting.html#cb11-17" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb11-18"><a href="two-arm-non-inferiority-setting.html#cb11-18" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Noninformative&quot;</span></span>
<span id="cb11-19"><a href="two-arm-non-inferiority-setting.html#cb11-19" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="fl">6.6</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Enthusiastic&quot;</span></span>
<span id="cb11-20"><a href="two-arm-non-inferiority-setting.html#cb11-20" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type[data_rpr<span class="sc">$</span>m_range<span class="sc">==</span><span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Informative&quot;</span></span>
<span id="cb11-21"><a href="two-arm-non-inferiority-setting.html#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="two-arm-non-inferiority-setting.html#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="two-arm-non-inferiority-setting.html#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Centered on noninferiority margin</span></span>
<span id="cb11-24"><a href="two-arm-non-inferiority-setting.html#cb11-24" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb11-25"><a href="two-arm-non-inferiority-setting.html#cb11-25" aria-hidden="true" tabindex="-1"></a>m_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">6.6</span>)</span>
<span id="cb11-26"><a href="two-arm-non-inferiority-setting.html#cb11-26" aria-hidden="true" tabindex="-1"></a>n_0_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">300</span>, <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb11-27"><a href="two-arm-non-inferiority-setting.html#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="two-arm-non-inferiority-setting.html#cb11-28" aria-hidden="true" tabindex="-1"></a>data_rpr_skep <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(m_range, n_0_range)</span>
<span id="cb11-29"><a href="two-arm-non-inferiority-setting.html#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_rpr_skep) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;m_range&quot;</span>, <span class="st">&quot;n_0_range&quot;</span>)</span>
<span id="cb11-30"><a href="two-arm-non-inferiority-setting.html#cb11-30" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>n_1_range <span class="ot">&lt;-</span> a<span class="sc">*</span>data_rpr_skep<span class="sc">$</span>n_0_range</span>
<span id="cb11-31"><a href="two-arm-non-inferiority-setting.html#cb11-31" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_0_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>n_1_range)</span>
<span id="cb11-32"><a href="two-arm-non-inferiority-setting.html#cb11-32" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>m_range)</span>
<span id="cb11-33"><a href="two-arm-non-inferiority-setting.html#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="two-arm-non-inferiority-setting.html#cb11-34" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>p_rpr <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(data_rpr_skep<span class="sc">$</span>sigma_treat<span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>data_rpr_skep<span class="sc">$</span>sigma_treat)<span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star)<span class="sc">-</span><span class="fu">qnorm</span>(gamma)))</span>
<span id="cb11-35"><a href="two-arm-non-inferiority-setting.html#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="two-arm-non-inferiority-setting.html#cb11-36" aria-hidden="true" tabindex="-1"></a>data_rpr_skep<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">&quot;Skeptical&quot;</span></span>
<span id="cb11-37"><a href="two-arm-non-inferiority-setting.html#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="two-arm-non-inferiority-setting.html#cb11-38" aria-hidden="true" tabindex="-1"></a>data_rpr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_rpr, data_rpr_skep)</span>
<span id="cb11-39"><a href="two-arm-non-inferiority-setting.html#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="two-arm-non-inferiority-setting.html#cb11-40" aria-hidden="true" tabindex="-1"></a>data_rpr<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_rpr<span class="sc">$</span>type, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;Enthusiastic&quot;</span>, <span class="st">&quot;Skeptical&quot;</span>, <span class="st">&quot;Informative&quot;</span>, <span class="st">&quot;Noninformative&quot;</span>))</span>
<span id="cb11-41"><a href="two-arm-non-inferiority-setting.html#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="two-arm-non-inferiority-setting.html#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_rpr, <span class="fu">aes</span>(<span class="at">x=</span>n_1_range<span class="sc">+</span>n_0_range, <span class="at">y=</span>p_rpr, <span class="at">colour=</span>type))<span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="st">&quot;Prior type&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;purple&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;darkred&quot;</span>))<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Planned total sample size&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="fu">str_glue</span>(<span class="st">&quot;Probability that RPR is greater than &quot;</span>, gamma<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;%&quot;</span>))<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">400</span>))<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">200</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span><span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>))</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<hr />
<p>Note that the average power AP integrates over the whole <span class="math inline">\(\Delta\)</span> range. This might include also ‘non-favorable’ regions. To see that one can decompose AP as follows (see <span class="citation">[<a href="#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span>, <span class="citation">[<a href="#ref-Grieve2022" role="doc-biblioref">4</a>]</span>):
<span class="math display">\[
AP=\overbrace{P(D\leq D_{suc}^{\delta^*}, \Delta&gt;\delta^*)}^{(1)}+\overbrace{P(D\leq D_{suc}^{\delta^*}, 0&lt;\Delta\leq\delta^*)}^{(2)}+\overbrace{P(D\leq D_{suc}^{\delta^*}, \Delta\leq0)}^{(3)}
\]</span>
where</p>
<ul>
<li><span class="math inline">\((1)\)</span> Probability of Type-I error,</li>
<li><span class="math inline">\((2)\)</span> ‘Non-inferior, but treatment effect not relevant’,</li>
<li><span class="math inline">\((3)\)</span> ‘Non-inferior, treatment effect relevant’.</li>
</ul>
<p><span class="citation">[<a href="#ref-Spiegelhalter2003" role="doc-biblioref">2</a>]</span> shows that <span class="math inline">\(AP \approx P(D\leq D_{suc}^{\delta^*}, \Delta\leq0)\)</span> because the type-I error is often small and one has strong believe for the alternative hypothesis <span class="citation">[<a href="#ref-Spiegelhalter2003" role="doc-biblioref">2</a>]</span>. <span class="citation">[<a href="#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span> and <span class="citation">[<a href="#ref-OHagan2005" role="doc-biblioref">5</a>]</span> discuss the relevance of the AP decomposition. For example, pharmaceutical companies might (1)+(2)+(3) taking into account shortterm risk, wheras regulators are interested in (1) or (1)+(2), that is non-inferior outcomes with relevant treatment effects.</p>
<p>For the non-inferiority setting we are interested in (2)+(3):</p>
<p><span class="math display">\[
P(D\leq D_{suc}^{\delta^*}, \Delta\leq\delta^*)=P(D\leq D_{suc}^{\delta^*}|\Delta\leq\delta^*)P(\Delta\leq\delta^*)=\underbrace{E\left[P_{\Delta\leq\delta^*}(D\leq D_{suc}^{\delta^*})\right]}_{EP}P(\Delta\leq\delta^*),
\]</span>
Kunzmann et al. denote EP the <strong>‘expected power’</strong> (<span class="citation">[<a href="#ref-Kunzmann2022" role="doc-biblioref">1</a>]</span>). Note that</p>
<p><span class="math display">\[
\underbrace{P(D\leq D_{suc}^{\delta^*}, \Delta\leq\delta^*)}_{PAP}=\underbrace{E\left[P_{\Delta\leq\delta^*}(D\leq D_{suc}^{\delta^*})\right]}_{EP}\underbrace{P(\Delta\leq\delta^*)}_{constant}.
\]</span>
Spiegelhalter calls <span class="math inline">\(P(P(D\leq D_{suc}^{\delta^*}, \Delta\leq\delta^*)\)</span> the <strong>‘prior adjusted power’</strong> (PAP):</p>
<p>The AP decomposition can be visualised using the posterior predictive distribution. Let <span class="math inline">\(p(\tilde\delta)\)</span> be the pdf of the posterior predictive distribution then
<span class="math display">\[
p(\tilde\delta, \delta)= N_2\left(\begin{pmatrix} d \\ d \end{pmatrix}, \begin{pmatrix} \sigma^2_{treat}+\sigma^2_{prior} \quad \sigma^2_{prior} \\ \quad \quad \sigma^2_{prior} \quad \ \quad  \sigma^2_{prior}\end{pmatrix}\right),
\]</span>
see formula (2.11) in <span class="citation">[<a href="#ref-Grieve2022" role="doc-biblioref">4</a>]</span>.</p>
<hr />
<p><strong>Working example (continued) </strong></p>
<p>For the SAFE-SSPE study the bivariate scatterplot of <span class="math inline">\(p(\tilde\delta, \delta)\)</span> under an enthusiastic prior can be visualised as:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="two-arm-non-inferiority-setting.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb12-2"><a href="two-arm-non-inferiority-setting.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-3"><a href="two-arm-non-inferiority-setting.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-4"><a href="two-arm-non-inferiority-setting.html#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="two-arm-non-inferiority-setting.html#cb12-5" aria-hidden="true" tabindex="-1"></a>delta_star <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb12-6"><a href="two-arm-non-inferiority-setting.html#cb12-6" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-7"><a href="two-arm-non-inferiority-setting.html#cb12-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb12-8"><a href="two-arm-non-inferiority-setting.html#cb12-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb12-9"><a href="two-arm-non-inferiority-setting.html#cb12-9" aria-hidden="true" tabindex="-1"></a>sigma_sim <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1<span class="sc">+</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m), (sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m, (sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m, (sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>m), <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">byrow=</span>T)</span>
<span id="cb12-10"><a href="two-arm-non-inferiority-setting.html#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="two-arm-non-inferiority-setting.html#cb12-11" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rmvnorm</span>(<span class="at">n=</span><span class="dv">10000</span>, <span class="at">mean=</span><span class="fu">c</span>(prior_mean, prior_mean), sigma_sim))</span>
<span id="cb12-12"><a href="two-arm-non-inferiority-setting.html#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_sim) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;delta_pred&quot;</span>, <span class="st">&quot;delta&quot;</span>)</span>
<span id="cb12-13"><a href="two-arm-non-inferiority-setting.html#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="two-arm-non-inferiority-setting.html#cb12-14" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_sim<span class="sc">$</span>delta<span class="sc">&lt;=</span><span class="dv">0</span> <span class="sc">&amp;</span> data_sim<span class="sc">$</span>delta_pred<span class="sc">&lt;=-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sd_tilde<span class="sc">/</span><span class="fu">sqrt</span>(n)<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb12-15"><a href="two-arm-non-inferiority-setting.html#cb12-15" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_sim<span class="sc">$</span>delta<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> data_sim<span class="sc">$</span>delta<span class="sc">&lt;=</span>delta_star <span class="sc">&amp;</span> data_sim<span class="sc">$</span>delta_pred<span class="sc">&lt;=-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sd_tilde<span class="sc">/</span><span class="fu">sqrt</span>(n)<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star), <span class="dv">2</span>, data_sim<span class="sc">$</span>region)</span>
<span id="cb12-16"><a href="two-arm-non-inferiority-setting.html#cb12-16" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_sim<span class="sc">$</span>delta<span class="sc">&gt;</span>delta_star <span class="sc">&amp;</span> data_sim<span class="sc">$</span>delta_pred<span class="sc">&lt;=-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sd_tilde<span class="sc">/</span><span class="fu">sqrt</span>(n)<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star), <span class="dv">3</span>, data_sim<span class="sc">$</span>region)</span>
<span id="cb12-17"><a href="two-arm-non-inferiority-setting.html#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="two-arm-non-inferiority-setting.html#cb12-18" aria-hidden="true" tabindex="-1"></a>data_sim<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_sim<span class="sc">$</span>region, <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;&#39;Not significant&#39;&quot;</span>, <span class="st">&quot;(3)&quot;</span>, <span class="st">&quot;(2)&quot;</span>, <span class="st">&quot;(1)&quot;</span>))</span>
<span id="cb12-19"><a href="two-arm-non-inferiority-setting.html#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="two-arm-non-inferiority-setting.html#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_sim, <span class="fu">aes</span>(<span class="at">x=</span>delta, <span class="at">y=</span>delta_pred, <span class="at">colour=</span><span class="fu">factor</span>(region)))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.3</span>)<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">0.035</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span><span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sd_tilde<span class="sc">/</span><span class="fu">sqrt</span>(n)<span class="sc">-</span>(prior_mean_enthusiastic<span class="sc">-</span>delta_star), <span class="at">linetype=</span><span class="st">&quot;dotted&quot;</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">caption=</span><span class="st">&quot;Dashed line: Noninferiority margin.</span><span class="sc">\n</span><span class="st">Dotted line: Upper confidence interval from mean of predicted delta &lt;= non-inferiority margin.&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Predictive distribution of Delta&quot;</span>)<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Delta&quot;</span>)<span class="sc">+</span><span class="fu">scale_color_brewer</span>(<span class="st">&quot;Region&quot;</span>, <span class="at">palette=</span><span class="st">&quot;Reds&quot;</span>)<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.2</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.035</span>, <span class="fl">0.2</span>))</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="two-arm-non-inferiority-setting.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(data_sim <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">prop=</span><span class="fu">n</span>()<span class="sc">/</span><span class="fu">nrow</span>(data_sim)))</span></code></pre></div>
</details>
<pre><code>##              region   prop
## 1 &#39;Not significant&#39; 0.4168
## 2               (3) 0.4851
## 3               (2) 0.0964
## 4               (1) 0.0017</code></pre>
<p>For the noninferiority setting <span class="math inline">\(\Delta\leq\delta^*\)</span>:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="two-arm-non-inferiority-setting.html#cb15-1" aria-hidden="true" tabindex="-1"></a>delta_star <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb15-2"><a href="two-arm-non-inferiority-setting.html#cb15-2" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-3"><a href="two-arm-non-inferiority-setting.html#cb15-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb15-4"><a href="two-arm-non-inferiority-setting.html#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="two-arm-non-inferiority-setting.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb15-6"><a href="two-arm-non-inferiority-setting.html#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="two-arm-non-inferiority-setting.html#cb15-7" aria-hidden="true" tabindex="-1"></a>sd_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb15-8"><a href="two-arm-non-inferiority-setting.html#cb15-8" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior)</span>
<span id="cb15-9"><a href="two-arm-non-inferiority-setting.html#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="two-arm-non-inferiority-setting.html#cb15-10" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>n_1)<span class="sc">/</span><span class="fu">sqrt</span>((n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>(draws<span class="sc">-</span>delta_star))</span>
<span id="cb15-11"><a href="two-arm-non-inferiority-setting.html#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="two-arm-non-inferiority-setting.html#cb15-12" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ep=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star]), <span class="at">pap=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star])<span class="sc">*</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">ap=</span><span class="fu">mean</span>(power_classic), <span class="at">const=</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">type=</span><span class="st">&quot;Skeptical&quot;</span>)</span>
<span id="cb15-13"><a href="two-arm-non-inferiority-setting.html#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="two-arm-non-inferiority-setting.html#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb15-15"><a href="two-arm-non-inferiority-setting.html#cb15-15" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb15-16"><a href="two-arm-non-inferiority-setting.html#cb15-16" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb15-17"><a href="two-arm-non-inferiority-setting.html#cb15-17" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior)</span>
<span id="cb15-18"><a href="two-arm-non-inferiority-setting.html#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="two-arm-non-inferiority-setting.html#cb15-19" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span><span class="fu">sqrt</span>(n)<span class="sc">/</span>sd_tilde<span class="sc">*</span>(draws<span class="sc">-</span>delta_star))</span>
<span id="cb15-20"><a href="two-arm-non-inferiority-setting.html#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="two-arm-non-inferiority-setting.html#cb15-21" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_ep, <span class="fu">data.frame</span>(<span class="at">ep=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star]), <span class="at">pap=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star])<span class="sc">*</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">ap=</span><span class="fu">mean</span>(power_classic), <span class="at">const=</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">type=</span><span class="st">&quot;Enthusiastic&quot;</span>))</span>
<span id="cb15-22"><a href="two-arm-non-inferiority-setting.html#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="two-arm-non-inferiority-setting.html#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="two-arm-non-inferiority-setting.html#cb15-24" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-25"><a href="two-arm-non-inferiority-setting.html#cb15-25" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb15-26"><a href="two-arm-non-inferiority-setting.html#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb15-27"><a href="two-arm-non-inferiority-setting.html#cb15-27" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior)</span>
<span id="cb15-28"><a href="two-arm-non-inferiority-setting.html#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="two-arm-non-inferiority-setting.html#cb15-29" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span><span class="fu">sqrt</span>(n)<span class="sc">/</span>sd_tilde<span class="sc">*</span>(draws<span class="sc">-</span>delta_star))</span>
<span id="cb15-30"><a href="two-arm-non-inferiority-setting.html#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="two-arm-non-inferiority-setting.html#cb15-31" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_ep, <span class="fu">data.frame</span>(<span class="at">ep=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star]), <span class="at">pap=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star])<span class="sc">*</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">ap=</span><span class="fu">mean</span>(power_classic), <span class="at">const=</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">type=</span><span class="st">&quot;Informative&quot;</span>))</span>
<span id="cb15-32"><a href="two-arm-non-inferiority-setting.html#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="two-arm-non-inferiority-setting.html#cb15-33" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-34"><a href="two-arm-non-inferiority-setting.html#cb15-34" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb15-35"><a href="two-arm-non-inferiority-setting.html#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb15-36"><a href="two-arm-non-inferiority-setting.html#cb15-36" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100000</span>, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_tilde<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fl">0.5</span>))</span>
<span id="cb15-37"><a href="two-arm-non-inferiority-setting.html#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="two-arm-non-inferiority-setting.html#cb15-38" aria-hidden="true" tabindex="-1"></a>power_classic <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">-</span><span class="fu">sqrt</span>(n)<span class="sc">/</span>sd_tilde<span class="sc">*</span>(draws<span class="sc">-</span>delta_star))</span>
<span id="cb15-39"><a href="two-arm-non-inferiority-setting.html#cb15-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-40"><a href="two-arm-non-inferiority-setting.html#cb15-40" aria-hidden="true" tabindex="-1"></a>data_ep <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_ep, <span class="fu">data.frame</span>(<span class="at">ep=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star]), <span class="at">pap=</span><span class="fu">mean</span>(power_classic[draws<span class="sc">&lt;=</span>delta_star])<span class="sc">*</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">ap=</span><span class="fu">mean</span>(power_classic), <span class="at">const=</span><span class="fu">pnorm</span>(delta_star, <span class="at">mean=</span>prior_mean, <span class="at">sd=</span>sd_prior), <span class="at">type=</span><span class="st">&quot;Noninformative&quot;</span>))</span>
<span id="cb15-41"><a href="two-arm-non-inferiority-setting.html#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="two-arm-non-inferiority-setting.html#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="two-arm-non-inferiority-setting.html#cb15-43" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>ep <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>ep, <span class="dv">4</span>)</span>
<span id="cb15-44"><a href="two-arm-non-inferiority-setting.html#cb15-44" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>ap <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>ap, <span class="dv">4</span>)</span>
<span id="cb15-45"><a href="two-arm-non-inferiority-setting.html#cb15-45" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>pap <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>pap, <span class="dv">4</span>)</span>
<span id="cb15-46"><a href="two-arm-non-inferiority-setting.html#cb15-46" aria-hidden="true" tabindex="-1"></a>data_ep<span class="sc">$</span>const <span class="ot">&lt;-</span> <span class="fu">round</span>(data_ep<span class="sc">$</span>const, <span class="dv">4</span>)</span>
<span id="cb15-47"><a href="two-arm-non-inferiority-setting.html#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="two-arm-non-inferiority-setting.html#cb15-48" aria-hidden="true" tabindex="-1"></a>data_ep</span></code></pre></div>
</details>
<pre><code>##       ep    pap     ap  const           type
## 1 0.7930 0.5857 0.5872 0.7386      Skeptical
## 2 0.6741 0.3370 0.3437 0.5000   Enthusiastic
## 3 0.7931 0.5858 0.5872 0.7386    Informative
## 4 0.9186 0.6785 0.5233 0.7386 Noninformative</code></pre>
<hr />
</div>
<div id="proper-bayesian-approach" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Proper Bayesian approach<a href="two-arm-non-inferiority-setting.html#proper-bayesian-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A proper Bayesian approach uses the posterior distribution to define ‘Bayesian significance’: <span class="math inline">\(S^B:=P(\Delta\leq\delta^*|data)=1-\epsilon\)</span>. Remember <span class="math inline">\(D=p_1-p_0\)</span> with <span class="math inline">\(D \sim N(\delta, \sigma^2_{treat})\)</span>. Suppose that <span class="math inline">\(\Delta \sim N(d, \sigma^2_{prior})\)</span> then the posterior distribution given <span class="math inline">\(D\)</span> is distributed as
<span class="math display">\[
\begin{aligned}
\Delta|D \sim N\left(\frac{\frac{d}{\sigma^2_{prior}}+\frac{D}{\sigma^2_{treat}}}{\frac{1}{\sigma^2_{prior}}+\frac{1}{\sigma^2_{treat}}}, \frac{1}{\frac{1}{\sigma^2_{prior}}+\frac{1}{\sigma^2_{treat}}}\right)=N\left( \frac{\sigma^2_{treat}d+\sigma^2_{prior}D}{\sigma^2_{treat}+\sigma^2_{prior}}, \frac{\sigma^2_{treat}\sigma^2_{prior}}{\sigma^2_{treat}+\sigma^2_{prior}}  \right)
\end{aligned}
\]</span></p>
<hr />
<p><strong>Special case</strong></p>
<p>If <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to</p>
<p><span class="math display">\[
\Delta|D \sim N\left(\frac{m\delta+nD}{n+m}, \frac{\sigma^2}{n+m} \right).
\]</span></p>
<hr />
<p>One is interested whether the upper <span class="math inline">\((1-\epsilon)\)</span> credible interval is smaller than the non-inferiority margin, that is</p>
<p><span class="math display">\[
\frac{\sigma^2_{treat}d+\sigma^2_{prior}D}{\sigma^2_{treat}+\sigma^2_{prior}}+z_{1-\epsilon}\frac{\sigma_{treat}\sigma_{prior}}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}\leq \delta^*.
\]</span>
A simple algebraic step gives</p>
<p><span class="math display">\[
\begin{aligned}
D\leq -z_{1-\epsilon}&amp;\frac{\sigma_{treat}}{\sigma_{prior}}\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}+\delta^*\left(1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right)-\frac{\sigma^2_{treat}}{\sigma^2_{prior}}d
\end{aligned}
\]</span>
Denote <span class="math inline">\(D_{suc}^{d,\delta^*}=-z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}+\delta^*\left(1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right)-\frac{\sigma^2_{treat}}{\sigma^2_{prior}}d\)</span> as the required risk difference for a successful rejection of the null hypothesis in the Bayesian setting.</p>
<p>Thus, since <span class="math inline">\(D\sim N(\delta, \sigma_{treat}^2)\)</span>,
<span class="math display">\[
\begin{aligned}
P(D\leq D_{suc}^{d,\delta^*}|\delta)&amp;=\Phi\left(-z_{1-\epsilon}\sqrt{1+\frac{\sigma^2_{treat}}{\sigma_{prior}^2}}-\frac{1}{\sigma_{treat}}\left[\delta-\delta^*\left\{ 1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2} \right\} \right]-\frac{\sigma_{treat}}{\sigma_{prior}^2}d \right).
\end{aligned}
\]</span>
This is the Bayesian power (or probability of rejection) assuming one knows the true treatment effect <span class="math inline">\(\delta\)</span>. Note that this is a conditional probability.</p>
<hr />
<p><strong>Special case</strong></p>
<p>If <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to
<span class="math display">\[
\begin{aligned}
P(S^B|\delta)&amp;=\Phi\left(-z_{1-\epsilon}\sqrt{\frac{n+m}{n}}- \frac{m}{\sqrt{2n\sigma^2}}d-\sqrt{\frac{n}{2n\sigma^2}}\left\{\delta-\delta^*\left(\frac{n+m}{n} \right)\right\} \right).
\end{aligned}
\]</span></p>
<hr />
<hr />
<p><strong>Working example (continued) </strong></p>
<p>We derive the Bayesian probability of rejection for the SAFE-SSPE study for differently assumed <span class="math inline">\(\delta\)</span> values.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="two-arm-non-inferiority-setting.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Delta range</span></span>
<span id="cb17-2"><a href="two-arm-non-inferiority-setting.html#cb17-2" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.001</span>)</span>
<span id="cb17-3"><a href="two-arm-non-inferiority-setting.html#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="two-arm-non-inferiority-setting.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Epsilon</span></span>
<span id="cb17-5"><a href="two-arm-non-inferiority-setting.html#cb17-5" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb17-6"><a href="two-arm-non-inferiority-setting.html#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="two-arm-non-inferiority-setting.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb17-8"><a href="two-arm-non-inferiority-setting.html#cb17-8" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-9"><a href="two-arm-non-inferiority-setting.html#cb17-9" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb17-10"><a href="two-arm-non-inferiority-setting.html#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="two-arm-non-inferiority-setting.html#cb17-11" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>epsilon)<span class="sc">*</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">+</span>m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))))<span class="sc">-</span>(m<span class="sc">*</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0)<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>prior_mean<span class="sc">-</span><span class="fu">sqrt</span>((n_1<span class="sc">*</span>n_0)<span class="sc">/</span>((n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span>(delta<span class="sc">-</span>delta_star<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>(m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb17-12"><a href="two-arm-non-inferiority-setting.html#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="two-arm-non-inferiority-setting.html#cb17-13" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(delta, <span class="at">y=</span>ap_bayes, <span class="at">type=</span><span class="st">&quot;Bayes: Enthusiastic&quot;</span>)</span>
<span id="cb17-14"><a href="two-arm-non-inferiority-setting.html#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="two-arm-non-inferiority-setting.html#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb17-16"><a href="two-arm-non-inferiority-setting.html#cb17-16" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb17-17"><a href="two-arm-non-inferiority-setting.html#cb17-17" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb17-18"><a href="two-arm-non-inferiority-setting.html#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="two-arm-non-inferiority-setting.html#cb17-19" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>epsilon)<span class="sc">*</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">+</span>m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))))<span class="sc">-</span>(m<span class="sc">*</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0)<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>prior_mean<span class="sc">-</span><span class="fu">sqrt</span>((n_1<span class="sc">*</span>n_0)<span class="sc">/</span>((n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span>(delta<span class="sc">-</span>delta_star<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>(m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb17-20"><a href="two-arm-non-inferiority-setting.html#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="two-arm-non-inferiority-setting.html#cb17-21" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y=</span>ap_bayes, <span class="at">type=</span><span class="st">&quot;Bayes: Skeptical&quot;</span>))</span>
<span id="cb17-22"><a href="two-arm-non-inferiority-setting.html#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="two-arm-non-inferiority-setting.html#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb17-24"><a href="two-arm-non-inferiority-setting.html#cb17-24" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-25"><a href="two-arm-non-inferiority-setting.html#cb17-25" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb17-26"><a href="two-arm-non-inferiority-setting.html#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="two-arm-non-inferiority-setting.html#cb17-27" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>epsilon)<span class="sc">*</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">+</span>m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))))<span class="sc">-</span>(m<span class="sc">*</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0)<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>prior_mean<span class="sc">-</span><span class="fu">sqrt</span>((n_1<span class="sc">*</span>n_0)<span class="sc">/</span>((n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span>(delta<span class="sc">-</span>delta_star<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>(m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb17-28"><a href="two-arm-non-inferiority-setting.html#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="two-arm-non-inferiority-setting.html#cb17-29" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y=</span>ap_bayes, <span class="at">type=</span><span class="st">&quot;Bayes: Informative&quot;</span>))</span>
<span id="cb17-30"><a href="two-arm-non-inferiority-setting.html#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="two-arm-non-inferiority-setting.html#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb17-32"><a href="two-arm-non-inferiority-setting.html#cb17-32" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-33"><a href="two-arm-non-inferiority-setting.html#cb17-33" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb17-34"><a href="two-arm-non-inferiority-setting.html#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="two-arm-non-inferiority-setting.html#cb17-35" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>epsilon)<span class="sc">*</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">+</span>m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))))<span class="sc">-</span>(m<span class="sc">*</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0)<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">*</span>prior_mean<span class="sc">-</span><span class="fu">sqrt</span>((n_1<span class="sc">*</span>n_0)<span class="sc">/</span>((n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">*</span>(delta<span class="sc">-</span>delta_star<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>(m<span class="sc">*</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(n_1<span class="sc">*</span>n_0<span class="sc">*</span>(sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_0<span class="sc">^</span><span class="dv">2</span>)))))</span>
<span id="cb17-36"><a href="two-arm-non-inferiority-setting.html#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="two-arm-non-inferiority-setting.html#cb17-37" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y=</span>ap_bayes, <span class="at">type=</span><span class="st">&quot;Bayes: Noninformative&quot;</span>))</span>
<span id="cb17-38"><a href="two-arm-non-inferiority-setting.html#cb17-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-39"><a href="two-arm-non-inferiority-setting.html#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequentist</span></span>
<span id="cb17-40"><a href="two-arm-non-inferiority-setting.html#cb17-40" aria-hidden="true" tabindex="-1"></a>y_freq <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span>(delta<span class="sc">-</span>delta_star)<span class="sc">*</span><span class="fu">sqrt</span>(n_1<span class="sc">*</span>n_0)<span class="sc">/</span><span class="fu">sqrt</span>(n_0<span class="sc">*</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>n_1<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha))</span>
<span id="cb17-41"><a href="two-arm-non-inferiority-setting.html#cb17-41" aria-hidden="true" tabindex="-1"></a>data_power <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_power, <span class="fu">data.frame</span>(delta, <span class="at">y=</span>y_freq, <span class="at">type=</span><span class="st">&quot;Frequentist&quot;</span>))</span>
<span id="cb17-42"><a href="two-arm-non-inferiority-setting.html#cb17-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-43"><a href="two-arm-non-inferiority-setting.html#cb17-43" aria-hidden="true" tabindex="-1"></a>data_power<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_power<span class="sc">$</span>type, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;Bayes: Enthusiastic&quot;</span>, <span class="st">&quot;Bayes: Skeptical&quot;</span>, <span class="st">&quot;Bayes: Informative&quot;</span>, <span class="st">&quot;Bayes: Noninformative&quot;</span>, <span class="st">&quot;Frequentist&quot;</span>))</span>
<span id="cb17-44"><a href="two-arm-non-inferiority-setting.html#cb17-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-45"><a href="two-arm-non-inferiority-setting.html#cb17-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-46"><a href="two-arm-non-inferiority-setting.html#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_power, <span class="fu">aes</span>(<span class="at">x=</span>delta, <span class="at">y=</span>y, <span class="at">colour=</span>type))<span class="sc">+</span><span class="fu">geom_line</span>()<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="st">&quot;Type&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;purple&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;darkred&quot;</span>, <span class="st">&quot;green&quot;</span>))<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Probability of rejection&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Probability to reject&quot;</span>)<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.025</span>,<span class="dv">0</span>,<span class="fl">0.035</span>,<span class="fl">0.050</span>))<span class="sc">+</span><span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="dv">1</span>))<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="fu">str_glue</span>(<span class="st">&quot;For treatment arm sample sizes: n0=&quot;</span>, <span class="fu">round</span>(n_0,<span class="dv">0</span>), <span class="st">&quot;, n1=&quot;</span>, <span class="fu">round</span>(n_1,<span class="dv">0</span>)))<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">0.035</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="two-arm-non-inferiority-setting.html#cb18-1" aria-hidden="true" tabindex="-1"></a>data_power<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">round</span>(data_power<span class="sc">$</span>y, <span class="dv">2</span>)</span>
<span id="cb18-2"><a href="two-arm-non-inferiority-setting.html#cb18-2" aria-hidden="true" tabindex="-1"></a>data_power <span class="sc">%&gt;%</span> <span class="fu">filter</span>(delta<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;0.035&quot;</span>))</span></code></pre></div>
</details>
<pre><code>##    delta    y                  type
## 1  0.000 0.83   Bayes: Enthusiastic
## 2  0.035 0.06   Bayes: Enthusiastic
## 3  0.000 0.78      Bayes: Skeptical
## 4  0.035 0.04      Bayes: Skeptical
## 5  0.000 0.90    Bayes: Informative
## 6  0.035 0.11    Bayes: Informative
## 7  0.000 0.80 Bayes: Noninformative
## 8  0.035 0.05 Bayes: Noninformative
## 9  0.000 0.80           Frequentist
## 10 0.035 0.05           Frequentist</code></pre>
<hr />
<p>The average (marginal) Bayesian probability of rejection (BAP) can be calculated as
<span class="math display">\[
\begin{aligned}
BAP&amp;=\int_{-\infty}^{-z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}+\delta^*\left(1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right)-\frac{\sigma^2_{treat}}{\sigma^2_{prior}}d} f(\tilde \delta)d\tilde \delta
\\&amp;=\Phi\left( -z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}\frac{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}+\frac{\delta^*}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}\left\{1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right\} \right. \\
  &amp; \left. \quad \quad \quad-\frac{d}{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}\left\{1+\frac{\sigma_{treat}^2}{\sigma_{prior}^2}\right\}\right) \\
&amp;=\Phi\left(-z_{1-\epsilon}\frac{\sigma_{treat}}{\sigma_{prior}}-\frac{\sqrt{\sigma^2_{treat}+\sigma^2_{prior}}}{\sigma^2_{prior}}(d-\delta^*)\right),
\end{aligned}
\]</span>
since for the posterior predictive distribution <span class="math inline">\(\tilde D \sim N(d, \sigma_{treat}^2+\sigma_{prior}^2)\)</span>.</p>
<hr />
<p><strong>Special case</strong></p>
<p>If <span class="math inline">\(n_0=n_1=n\)</span> and <span class="math inline">\(\sigma_1^2=\sigma_0^2=\sigma^2\)</span>, then <span class="math inline">\(\sigma_{treat}^2=\frac{2\sigma^2}{n}\)</span> and <span class="math inline">\(\sigma_{prior}^2=\frac{2\sigma^2}{m}\)</span>, and the formula above reduces to
<span class="math display">\[
\begin{aligned}
BAP&amp;=-z_{1-\epsilon}\sqrt{\frac{m}{n}}-\sqrt{\frac{(m+n)m}{2n\sigma^2}}(d-\delta^*)
\end{aligned}
\]</span></p>
<hr />
<hr />
<p><strong>Working example (continued) </strong></p>
<p>We derive the average Bayesian probability of rejection for the SAFE-SSPE study.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb20"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb20-1"><a href="two-arm-non-inferiority-setting.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Hybrid AP</span></span>
<span id="cb20-2"><a href="two-arm-non-inferiority-setting.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="two-arm-non-inferiority-setting.html#cb20-3" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb20-4"><a href="two-arm-non-inferiority-setting.html#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="two-arm-non-inferiority-setting.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb20-6"><a href="two-arm-non-inferiority-setting.html#cb20-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb20-7"><a href="two-arm-non-inferiority-setting.html#cb20-7" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-8"><a href="two-arm-non-inferiority-setting.html#cb20-8" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-9"><a href="two-arm-non-inferiority-setting.html#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="two-arm-non-inferiority-setting.html#cb20-10" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb20-11"><a href="two-arm-non-inferiority-setting.html#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="two-arm-non-inferiority-setting.html#cb20-12" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Enthusiastic&quot;</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP, <span class="dv">3</span>))</span>
<span id="cb20-13"><a href="two-arm-non-inferiority-setting.html#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="two-arm-non-inferiority-setting.html#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb20-15"><a href="two-arm-non-inferiority-setting.html#cb20-15" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb20-16"><a href="two-arm-non-inferiority-setting.html#cb20-16" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb20-17"><a href="two-arm-non-inferiority-setting.html#cb20-17" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-18"><a href="two-arm-non-inferiority-setting.html#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="two-arm-non-inferiority-setting.html#cb20-19" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb20-20"><a href="two-arm-non-inferiority-setting.html#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="two-arm-non-inferiority-setting.html#cb20-21" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Skeptical&quot;</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP, <span class="dv">3</span>)))</span>
<span id="cb20-22"><a href="two-arm-non-inferiority-setting.html#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="two-arm-non-inferiority-setting.html#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb20-24"><a href="two-arm-non-inferiority-setting.html#cb20-24" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb20-25"><a href="two-arm-non-inferiority-setting.html#cb20-25" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-26"><a href="two-arm-non-inferiority-setting.html#cb20-26" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-27"><a href="two-arm-non-inferiority-setting.html#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="two-arm-non-inferiority-setting.html#cb20-28" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb20-29"><a href="two-arm-non-inferiority-setting.html#cb20-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-30"><a href="two-arm-non-inferiority-setting.html#cb20-30" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Informative&quot;</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP, <span class="dv">3</span>)))</span>
<span id="cb20-31"><a href="two-arm-non-inferiority-setting.html#cb20-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-32"><a href="two-arm-non-inferiority-setting.html#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb20-33"><a href="two-arm-non-inferiority-setting.html#cb20-33" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb20-34"><a href="two-arm-non-inferiority-setting.html#cb20-34" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-35"><a href="two-arm-non-inferiority-setting.html#cb20-35" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-36"><a href="two-arm-non-inferiority-setting.html#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-37"><a href="two-arm-non-inferiority-setting.html#cb20-37" aria-hidden="true" tabindex="-1"></a>AP <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">1</span><span class="sc">/</span>sigma_prior<span class="sc">*</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">-</span>(prior_mean<span class="sc">-</span>delta_star)))</span>
<span id="cb20-38"><a href="two-arm-non-inferiority-setting.html#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="two-arm-non-inferiority-setting.html#cb20-39" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Noninformative&quot;</span>, n_0, n_1, <span class="at">AP=</span><span class="fu">round</span>(AP, <span class="dv">3</span>)))</span>
<span id="cb20-40"><a href="two-arm-non-inferiority-setting.html#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="two-arm-non-inferiority-setting.html#cb20-41" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> data_output <span class="sc">%&gt;%</span> <span class="fu">select</span>(type, n_0, n_1, AP)</span>
<span id="cb20-42"><a href="two-arm-non-inferiority-setting.html#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="two-arm-non-inferiority-setting.html#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="do">### Bayesian AP</span></span>
<span id="cb20-44"><a href="two-arm-non-inferiority-setting.html#cb20-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-45"><a href="two-arm-non-inferiority-setting.html#cb20-45" aria-hidden="true" tabindex="-1"></a>sigma_treat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_0<span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_1))</span>
<span id="cb20-46"><a href="two-arm-non-inferiority-setting.html#cb20-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-47"><a href="two-arm-non-inferiority-setting.html#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Enthusiastic prior</span></span>
<span id="cb20-48"><a href="two-arm-non-inferiority-setting.html#cb20-48" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-49"><a href="two-arm-non-inferiority-setting.html#cb20-49" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb20-50"><a href="two-arm-non-inferiority-setting.html#cb20-50" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-51"><a href="two-arm-non-inferiority-setting.html#cb20-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-52"><a href="two-arm-non-inferiority-setting.html#cb20-52" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span><span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star))</span>
<span id="cb20-53"><a href="two-arm-non-inferiority-setting.html#cb20-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-54"><a href="two-arm-non-inferiority-setting.html#cb20-54" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Enthusiastic&quot;</span>, n_0, n_1, <span class="at">AP_bayes=</span><span class="fu">round</span>(ap_bayes, <span class="dv">3</span>))</span>
<span id="cb20-55"><a href="two-arm-non-inferiority-setting.html#cb20-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-56"><a href="two-arm-non-inferiority-setting.html#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Skeptical prior</span></span>
<span id="cb20-57"><a href="two-arm-non-inferiority-setting.html#cb20-57" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> delta_star</span>
<span id="cb20-58"><a href="two-arm-non-inferiority-setting.html#cb20-58" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">6.6</span></span>
<span id="cb20-59"><a href="two-arm-non-inferiority-setting.html#cb20-59" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-60"><a href="two-arm-non-inferiority-setting.html#cb20-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-61"><a href="two-arm-non-inferiority-setting.html#cb20-61" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span><span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star))</span>
<span id="cb20-62"><a href="two-arm-non-inferiority-setting.html#cb20-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-63"><a href="two-arm-non-inferiority-setting.html#cb20-63" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output2, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Skeptical&quot;</span>, n_0, n_1, <span class="at">AP_bayes=</span><span class="fu">round</span>(ap_bayes, <span class="dv">3</span>)))</span>
<span id="cb20-64"><a href="two-arm-non-inferiority-setting.html#cb20-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-65"><a href="two-arm-non-inferiority-setting.html#cb20-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Informative prior</span></span>
<span id="cb20-66"><a href="two-arm-non-inferiority-setting.html#cb20-66" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-67"><a href="two-arm-non-inferiority-setting.html#cb20-67" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb20-68"><a href="two-arm-non-inferiority-setting.html#cb20-68" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-69"><a href="two-arm-non-inferiority-setting.html#cb20-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-70"><a href="two-arm-non-inferiority-setting.html#cb20-70" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span><span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star))</span>
<span id="cb20-71"><a href="two-arm-non-inferiority-setting.html#cb20-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-72"><a href="two-arm-non-inferiority-setting.html#cb20-72" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output2, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Informative&quot;</span>, n_0, n_1, <span class="at">AP_bayes=</span><span class="fu">round</span>(ap_bayes, <span class="dv">3</span>)))</span>
<span id="cb20-73"><a href="two-arm-non-inferiority-setting.html#cb20-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-74"><a href="two-arm-non-inferiority-setting.html#cb20-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Noninformative prior</span></span>
<span id="cb20-75"><a href="two-arm-non-inferiority-setting.html#cb20-75" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-76"><a href="two-arm-non-inferiority-setting.html#cb20-76" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb20-77"><a href="two-arm-non-inferiority-setting.html#cb20-77" aria-hidden="true" tabindex="-1"></a>sigma_prior <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_0<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sd_1<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(m)</span>
<span id="cb20-78"><a href="two-arm-non-inferiority-setting.html#cb20-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-79"><a href="two-arm-non-inferiority-setting.html#cb20-79" aria-hidden="true" tabindex="-1"></a>ap_bayes <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span>sigma_treat<span class="sc">/</span>sigma_prior<span class="sc">-</span><span class="fu">sqrt</span>(sigma_treat<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>sigma_prior<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma_prior<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(prior_mean<span class="sc">-</span>delta_star))</span>
<span id="cb20-80"><a href="two-arm-non-inferiority-setting.html#cb20-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-81"><a href="two-arm-non-inferiority-setting.html#cb20-81" aria-hidden="true" tabindex="-1"></a>data_output2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_output2, <span class="fu">data.frame</span>(<span class="at">type=</span><span class="st">&quot;Noninformative&quot;</span>, n_0, n_1, <span class="at">AP_bayes=</span><span class="fu">round</span>(ap_bayes, <span class="dv">3</span>)))</span>
<span id="cb20-82"><a href="two-arm-non-inferiority-setting.html#cb20-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-83"><a href="two-arm-non-inferiority-setting.html#cb20-83" aria-hidden="true" tabindex="-1"></a>data_output <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data_output, data_output2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(type, AP_bayes), <span class="at">by=</span><span class="st">&quot;type&quot;</span>)</span>
<span id="cb20-84"><a href="two-arm-non-inferiority-setting.html#cb20-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-85"><a href="two-arm-non-inferiority-setting.html#cb20-85" aria-hidden="true" tabindex="-1"></a>data_output <span class="sc">%&gt;%</span> <span class="fu">select</span>(type, n_0, n_1, <span class="at">AP_hybrid=</span>AP, AP_bayes)</span></code></pre></div>
</details>
<pre><code>##             type      n_0      n_1 AP_hybrid AP_bayes
## 1   Enthusiastic 99.93031 99.93031     0.586    0.594
## 2      Skeptical 99.93031 99.93031     0.336    0.336
## 3    Informative 99.93031 99.93031     0.663    0.715
## 4 Noninformative 99.93031 99.93031     0.524    0.524</code></pre>
<hr />

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-Kunzmann2022" class="csl-entry">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Kunzmann K, Grayling MJ, Lee KM, Robertson DS, Rufibach K, Wason JMS. A review of bayesian perspectives on sample size derivation for confirmatory trials. The American Statistician. 2021;75: 424–432. doi:<a href="https://doi.org/10.1080/00031305.2021.1901782">10.1080/00031305.2021.1901782</a></div>
</div>
<div id="ref-Spiegelhalter2003" class="csl-entry">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Spiegelhalter DJ, Abrams KR, Myles JP. Bayesian approaches to clinical trials and health‐care evaluation. Wiley; 2003. doi:<a href="https://doi.org/10.1002/0470092602">10.1002/0470092602</a></div>
</div>
<div id="ref-Baumgartner2020" class="csl-entry">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Baumgartner C, Klok FA, Carrier M, Limacher A, Moor J, Righini M, et al. Clinical surveillance vs. Anticoagulation for low-risk patiEnts with isolated SubSegmental pulmonary embolism: Protocol for a multicentre randomised placebo-controlled non-inferiority trial (SAFE-SSPE). BMJ Open. 2020;10: e040151. doi:<a href="https://doi.org/10.1136/bmjopen-2020-040151">10.1136/bmjopen-2020-040151</a></div>
</div>
<div id="ref-Grieve2022" class="csl-entry">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Grieve AP. Hybrid frequentist/bayesian power and bayesian power in planning clinical trials. Chapman; Hall/CRC; 2022. doi:<a href="https://doi.org/10.1201/9781003218531">10.1201/9781003218531</a></div>
</div>
<div id="ref-OHagan2005" class="csl-entry">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">O’Hagan A, Stevens JW, Campbell MJ. Assurance in clinical trial design. Pharmaceutical Statistics. 2005;4: 187–201. doi:<a href="https://doi.org/10.1002/pst.175">10.1002/pst.175</a></div>
</div>
<div id="ref-Rufibach2016" class="csl-entry">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">Rufibach K, Burger HU, Abt M. Bayesian predictive power: Choice of prior and some recommendations for its use as probability of success in drug development. Pharmaceutical Statistics. 2016;15: 438–446. doi:<a href="https://doi.org/10.1002/pst.1764">10.1002/pst.1764</a></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
