<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Two-arm non-inferiority setting | Frequentist, Bayesian and hybrid approaches for sample size and power calculations</title>
  <meta name="description" content="Chapter 2 Two-arm non-inferiority setting | Frequentist, Bayesian and hybrid approaches for sample size and power calculations" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Two-arm non-inferiority setting | Frequentist, Bayesian and hybrid approaches for sample size and power calculations" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Two-arm non-inferiority setting | Frequentist, Bayesian and hybrid approaches for sample size and power calculations" />
  
  
  

<meta name="author" content="AndrÃ© Moser, CTU Bern, University of Bern" />


<meta name="date" content="2023-04-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Frequentist, Bayesian and hybrid approaches to sample size and power calculations</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Background</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#aim"><i class="fa fa-check"></i><b>1.1</b> Aim</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#a-timeline-of-selected-literature"><i class="fa fa-check"></i><b>1.2</b> A timeline of selected literature</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html"><i class="fa fa-check"></i><b>2</b> Two-arm non-inferiority setting</a>
<ul>
<li class="chapter" data-level="2.1" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#binomial-outcome"><i class="fa fa-check"></i><b>2.1</b> Binomial outcome</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#frequentist-sample-size"><i class="fa fa-check"></i><b>2.1.1</b> Frequentist sample size</a></li>
<li class="chapter" data-level="2.1.2" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#frequentist-sample-size-calculation-in-r"><i class="fa fa-check"></i><b>2.1.2</b> Frequentist sample size: Calculation in R</a></li>
<li class="chapter" data-level="2.1.3" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#hybrid-approach"><i class="fa fa-check"></i><b>2.1.3</b> Hybrid approach</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#hybrid-approach-1"><i class="fa fa-check"></i><b>2.2</b> Hybrid approach</a></li>
<li class="chapter" data-level="2.3" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#hybrid-approach-2"><i class="fa fa-check"></i><b>2.3</b> Hybrid approach</a></li>
<li class="chapter" data-level="2.4" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#hybrid-approach-3"><i class="fa fa-check"></i><b>2.4</b> Hybrid approach</a></li>
<li class="chapter" data-level="2.5" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#implications"><i class="fa fa-check"></i><b>2.5</b> Implications</a></li>
<li class="chapter" data-level="2.6" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#implications-1"><i class="fa fa-check"></i><b>2.6</b> Implications</a></li>
<li class="chapter" data-level="2.7" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#implications-2"><i class="fa fa-check"></i><b>2.7</b> Implications</a></li>
<li class="chapter" data-level="2.8" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#decomposition-of-ap"><i class="fa fa-check"></i><b>2.8</b> Decomposition of AP</a></li>
<li class="chapter" data-level="2.9" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#decomposition-of-ap-1"><i class="fa fa-check"></i><b>2.9</b> Decomposition of AP</a></li>
<li class="chapter" data-level="2.10" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#expected-power"><i class="fa fa-check"></i><b>2.10</b> Expected power</a></li>
<li class="chapter" data-level="2.11" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#to-make-things-more-powerful-confusing"><i class="fa fa-check"></i><b>2.11</b> To make things more powerful confusing</a></li>
<li class="chapter" data-level="2.12" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#ep-pap-ap"><i class="fa fa-check"></i><b>2.12</b> EP, PAP, AP</a></li>
<li class="chapter" data-level="2.13" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#conditional-bayesian-power"><i class="fa fa-check"></i><b>2.13</b> Conditional Bayesian power</a></li>
<li class="chapter" data-level="2.14" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#conditional-bayesian-power-1"><i class="fa fa-check"></i><b>2.14</b> Conditional Bayesian power</a></li>
<li class="chapter" data-level="2.15" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#average-bayesian-power"><i class="fa fa-check"></i><b>2.15</b> Average Bayesian power</a></li>
<li class="chapter" data-level="2.16" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#power-vocabulary-summary"><i class="fa fa-check"></i><b>2.16</b> Power vocabulary summary (ðŸ’ª)</a></li>
<li class="chapter" data-level="2.17" data-path="two-arm-non-inferiority-setting.html"><a href="two-arm-non-inferiority-setting.html#from-the-safe-sspe-study-protocol"><i class="fa fa-check"></i><b>2.17</b> From the SAFE-SSPE study protocol</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Frequentist, Bayesian and hybrid approaches for sample size and power calculations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="two-arm-non-inferiority-setting" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Two-arm non-inferiority setting<a href="two-arm-non-inferiority-setting.html#two-arm-non-inferiority-setting" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We consider a non-inferiority clinical trial with <span class="math inline">\(H_0: \delta &gt; \delta^*\)</span> and <span class="math inline">\(H_a: \delta \leq \delta^*\)</span>, where <span class="math inline">\(\delta^*&gt;0\)</span> is a fixed non-inferiority margin and a treatment effect <span class="math inline">\(\delta\)</span>.</p>
<p>For example, <span class="math inline">\(H_0\)</span> is â€˜clinical surveillance is inferior to an active treatmentâ€™ versus <span class="math inline">\(H_a\)</span> â€˜clinical surveillance is non-inferior to an active treatmentâ€™. The primary outcome is a risk difference with an non-inferiority margin of 3.5%.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div id="binomial-outcome" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Binomial outcome<a href="two-arm-non-inferiority-setting.html#binomial-outcome" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here <span class="math inline">\(\delta=p_1-p_0\)</span>, where <span class="math inline">\(p_i\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>, are event probabilities for two groups.</p>
<div id="frequentist-sample-size" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Frequentist sample size<a href="two-arm-non-inferiority-setting.html#frequentist-sample-size" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let <span class="math inline">\(Y_{i,k} \sim^{iid} Bernoulli(p_i)\)</span>, <span class="math inline">\(k=1,\dots,n_i\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>. Then <span class="math inline">\(\overline p_i=\frac{1}{n_i}\sum_{k\leq n_i} Y_{i,k}\)</span>, <span class="math inline">\(i\in {0,1}\)</span>, is a consistent and sufficient statistic for <span class="math inline">\(p_i\)</span>, and thus <span class="math inline">\(D=\overline p_1-\overline p_0\)</span> is Gaussian distributed with <span class="math inline">\(D \sim N\left(\delta, \frac{\sigma_1^2}{n_1}+\frac{\sigma_0^2}{n_0}\right)\)</span>, where <span class="math inline">\(\sigma_i^2=p_i(1-p_i)\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>.</p>
<p>We are interested whether the upper <span class="math inline">\((1-\alpha)\%\)</span>-confidence limit is smaller than the non-inferiority margin, that is,
<span class="math display">\[
D+z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}\leq \delta^*,
\]</span>
where <span class="math inline">\(z_{1-\alpha}=\Phi^{-1}(1-\alpha)\)</span> with <span class="math inline">\(\Phi^{-1}\)</span>, the quantile function of the standard Gaussian distribution function.</p>
<p>Because
<span class="math display">\[
D\leq -z_{1-\alpha}\sqrt{\frac{n_0\sigma_1^2+n_1\sigma_0^2}{n_1n_0}}+\delta^*
\]</span>
we have that, for <span class="math inline">\(\Phi\)</span> being the probability distribution function of the standard Gaussian distribution,
<span class="math display">\[
P(S^{F}|\delta)=P_{\delta}(Z\leq - z_{1-\alpha})= \Phi\left(-z_{1-\alpha}-\sqrt{\frac{n_1n_0}{n_0\sigma_1^2+n_1\sigma_0^2}}(\delta-\delta^*)\right),
\]</span>
since
<span class="math display">\[
Z=\sqrt{\frac{n_1n_0}{n_0\sigma_1^2+n_1\sigma_0^2}}(D-\delta) \rightarrow^{n \rightarrow \infty} N(0,1).
\]</span>
For an alternative point difference <span class="math inline">\(\delta_A\)</span> we have that <span class="math inline">\(P_{\delta_A}(Z\leq - z_{1-\alpha})=1-\beta\)</span>, which is known as the frequentist power (or the <strong>probability of rejection given <span class="math inline">\(\delta_A\)</span></strong>). From that we have that</p>
<p><span class="math display">\[
-z_{1-\alpha}-\sqrt{\frac{n_1n_0}{n_0\sigma_1^2+n_1\sigma_0^2}}(\delta-\delta^*)=\Phi^{-1}(1-\beta)=z_{1-\beta}
\]</span>
and so the frequentist sample size can then be derived as
<span class="math display">\[
\frac{(z_{1-\beta}+z_{1-\alpha})^2}{(\delta-\delta^*)^2}=\frac{an_0^2}{n_0\sigma_1^2+an_0\sigma_0^2},
\]</span>
where <span class="math inline">\(a=n_1/n_0\)</span> is an allocation ratio, such that
<span class="math display">\[
n_0=(z_{1-\beta}+z_{1-\alpha})^2\frac{\sigma_1^2+a\sigma_0^2}{a(\delta-\delta^*)^2}, \quad n_1=an_0.
\]</span></p>
</div>
<div id="frequentist-sample-size-calculation-in-r" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Frequentist sample size: Calculation in R<a href="two-arm-non-inferiority-setting.html#frequentist-sample-size-calculation-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following <span class="math inline">\(R\)</span> function can be used to calculate the required sample size.</p>
<ul>
<li><span class="math inline">\(p_1=0.01\)</span>, <span class="math inline">\(p_0=0.01\)</span>, <span class="math inline">\(\delta^*=0.035\)</span>, <span class="math inline">\(1-\beta=0.8\)</span>, <span class="math inline">\(\alpha=0.05\)</span>, <span class="math inline">\(a=1/1\)</span></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="two-arm-non-inferiority-setting.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epiR)</span>
<span id="cb2-2"><a href="two-arm-non-inferiority-setting.html#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="two-arm-non-inferiority-setting.html#cb2-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb2-4"><a href="two-arm-non-inferiority-setting.html#cb2-4" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb2-5"><a href="two-arm-non-inferiority-setting.html#cb2-5" aria-hidden="true" tabindex="-1"></a>p_0 <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb2-6"><a href="two-arm-non-inferiority-setting.html#cb2-6" aria-hidden="true" tabindex="-1"></a>p_1 <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb2-7"><a href="two-arm-non-inferiority-setting.html#cb2-7" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> p_1<span class="sc">-</span>p_0</span>
<span id="cb2-8"><a href="two-arm-non-inferiority-setting.html#cb2-8" aria-hidden="true" tabindex="-1"></a>delta_star <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb2-9"><a href="two-arm-non-inferiority-setting.html#cb2-9" aria-hidden="true" tabindex="-1"></a>sd_0 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p_0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p_0))</span>
<span id="cb2-10"><a href="two-arm-non-inferiority-setting.html#cb2-10" aria-hidden="true" tabindex="-1"></a>sd_1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p_1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p_1))</span>
<span id="cb2-11"><a href="two-arm-non-inferiority-setting.html#cb2-11" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1</span></span>
<span id="cb2-12"><a href="two-arm-non-inferiority-setting.html#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="two-arm-non-inferiority-setting.html#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">epi.ssninfb</span>(<span class="at">treat=</span>p_1, <span class="at">control=</span>p_0, <span class="at">delta=</span>delta_star, <span class="at">power=</span><span class="dv">1</span><span class="sc">-</span>beta, <span class="at">r=</span>a, <span class="at">alpha=</span>alpha, <span class="at">n=</span><span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## $n.total
## [1] 200
## 
## $n.treat
## [1] 100
## 
## $n.control
## [1] 100
## 
## $delta
## [1] 0.035
## 
## $power
## [1] 0.8</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="two-arm-non-inferiority-setting.html#cb4-1" aria-hidden="true" tabindex="-1"></a>n_0 <span class="ot">&lt;-</span> ((<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>beta)<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha))<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>((sd_1<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>a<span class="sc">*</span>sd_0<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(a<span class="sc">*</span>(delta<span class="sc">-</span>delta_star)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb4-2"><a href="two-arm-non-inferiority-setting.html#cb4-2" aria-hidden="true" tabindex="-1"></a>n_0</span></code></pre></div>
<pre><code>## [1] 99.93031</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="two-arm-non-inferiority-setting.html#cb6-1" aria-hidden="true" tabindex="-1"></a>n_1 <span class="ot">&lt;-</span> n_0<span class="sc">*</span>a</span>
<span id="cb6-2"><a href="two-arm-non-inferiority-setting.html#cb6-2" aria-hidden="true" tabindex="-1"></a>n_1</span></code></pre></div>
<pre><code>## [1] 99.93031</code></pre>
<p><span class="math inline">\(\delta_A\)</span> and <span class="math inline">\(\delta^*\)</span> in a frequentist setting are assumed as fixed constants. Their choices are of high importance, because all trial conclusions are based on those choices and affect the sample size calculation. The plot below shows how the sample size increase as <span class="math inline">\(\delta^* \rightarrow \delta\)</span>.</p>
<pre><code>## Scale for x is already present.
## Adding another scale for x, which will replace the existing scale.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="hybrid-approach" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Hybrid approach<a href="two-arm-non-inferiority-setting.html#hybrid-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A hybrid approach assumes that the true treatment effect <span class="math inline">\(\delta\)</span> is a realization from a random variable <span class="math inline">\(\Delta\)</span> with prior probability density function <span class="math inline">\(p(\delta)\)</span>. The prior is defined before data collection (â€˜design priorâ€™). If we assume that <span class="math inline">\(\pi_i:=p_i(\delta)=Beta(a_i,b_i)\)</span>, then the posterior distribution is <span class="math inline">\(Beta(a_i+\sum_{k\leq n_i}Y_{i,k},b_i+n_i-\sum_{k\leq n_i}Y_{i,k})\)</span>. The variance is given as</p>
<p><span class="math display">\[
\frac{\left(a_i+\sum_{k\leq n_i}Y_{i,k}\right)\left(b_i+n_i-\sum_{k\leq n_i}Y_{i,k}\right)}{(a_i+b_i+n_i)^2(a_i+b_i+n_i+1)}
\]</span></p>
<p><img src="_main_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>with Gaussian prior <span class="math inline">\(\Delta \sim N\left(d, \frac{\sigma_1^2}{n_1}+\frac{\sigma_0^2}{n_0}\right)\)</span>, where <span class="math inline">\(\sigma_i^2=p_i(1-p_i)\)</span>, <span class="math inline">\(i\in \{0,1\}\)</span>. The prior can be thought as a</p>
<p>In the following we choose the following prior:</p>
<ul>
<li><strong>Enthusiastic</strong> prior (favors non-inferiority): <span class="math inline">\(d=0\)</span>, <span class="math inline">\(n_0=6.6\)</span>, <span class="math inline">\(P(\Delta&gt;\delta^*)=0.05\)</span>. This prior is centered on the treatment effect such that there is a low probability (here 5%) of inferiority.</li>
<li><strong>Skeptical</strong> prior (favors inferiority): <span class="math inline">\(d=\delta^*\)</span>, <span class="math inline">\(n_0=6.6\)</span>, <span class="math inline">\(P(\Delta&gt;0)=0.05\)</span>. This prior is centered on the non-inferiority margin such that there is a low probability (here 5%) of superiority.</li>
<li><strong>Informative</strong> prior (clinical expert knowledge): <span class="math inline">\(d=0\)</span> with <span class="math inline">\(n_0=25\)</span>.</li>
<li><strong>Noninformative</strong> prior (please do not use in practice!): <span class="math inline">\(d=0\)</span> with <span class="math inline">\(n_0=0.5\)</span>.</li>
</ul>
</div>
</div>
<div id="hybrid-approach-1" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Hybrid approach<a href="two-arm-non-inferiority-setting.html#hybrid-approach-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="hybrid-approach-2" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Hybrid approach<a href="two-arm-non-inferiority-setting.html#hybrid-approach-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>â€˜Powerâ€™: <span class="math inline">\(P(S_{1-\alpha}|\delta, \delta^*)=\Phi\left(-z_{1-\alpha}-\sqrt{\frac{n}{\tilde\sigma^2}}(\delta-\delta^*)\right)\)</span></li>
<li>â€˜Average powerâ€™ (Grieve), assurance (Oâ€™Hagan), probability of success (<strong>!</strong>) (Kunzmann et al., Spiegelhalter): <span class="math inline">\(AP=\int_{\Delta} P(S^{F}|\delta, \delta^*)p(\delta)d\delta\)</span>, where <span class="math inline">\(\Delta \sim p(\delta)\)</span></li>
<li><span class="math inline">\(AP=\Phi\left(\sqrt{\frac{n_0}{n_0+n}}\left[-z_{1-\alpha}-\sqrt{\frac{n}{\tilde\sigma^2}}(d-\delta^*)\right]\right)\)</span></li>
<li>Upper bound of AP: <span class="math inline">\(AP \rightarrow \Phi\left(-(d-\delta^*)\sqrt{\frac{n_0}{\tilde\sigma^2}}\right)\)</span>, as <span class="math inline">\({n \rightarrow \infty}\)</span></li>
<li>As <span class="math inline">\(n_0 \rightarrow \infty\)</span>: <span class="math inline">\(AP \rightarrow P(S_{1-\alpha}|d)\)</span> (aka classical power at <span class="math inline">\(d\)</span>)</li>
</ul>
</div>
<div id="hybrid-approach-3" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Hybrid approach<a href="two-arm-non-inferiority-setting.html#hybrid-approach-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Results:</p>
<pre><code>##             type  n_0   n   AP upper_AP
## 1   Enthusiastic  6.6 100 0.58     0.74
## 2    Informative 25.0 100 0.65     0.89
## 3 Noninformative  0.5 100 0.52     0.57
## 4      Skeptical  6.6 100 0.34     0.50</code></pre>
<p><strong>Question</strong>: Is 58% (AP) low compared to 80% (classical â€˜powerâ€™)?</p>
<p>Results easily can include inclusion of uncertainty about <span class="math inline">\(\delta^*\)</span>, say, <span class="math inline">\(\delta^*\sim Un(0.005, 0.05)\)</span>.</p>
</div>
<div id="implications" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Implications<a href="two-arm-non-inferiority-setting.html#implications" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Rufibach et al.Â (2016) give a closed a formula for the distribution of <span class="math inline">\(RPR:=P_{\Delta}(Z\leq - z_{1-\alpha})\)</span>, where <span class="math inline">\(\Delta \sim N(d,\tilde\sigma^2/n_0)\)</span>, and discuss the shape under different prior choices (RPR=â€™Random probability to reject`, see Kunzmann et al.)</p>
<ul>
<li>u-shaped if <span class="math inline">\(n_0&lt;n\)</span> (â€˜prior sampleâ€™ size is smaller than planned sample size)</li>
</ul>
<pre><code>## Warning: Removed 128 rows containing missing values (`geom_line()`).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="implications-1" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Implications<a href="two-arm-non-inferiority-setting.html#implications-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>unimodal if <span class="math inline">\(n=n_0\)</span></li>
<li>â€˜hillâ€™-shape if <span class="math inline">\(n_0&gt;n\)</span> (rather unrealistic interpretation)</li>
</ul>
<pre><code>## Warning: Removed 9 rows containing missing values (`geom_line()`).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="implications-2" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Implications<a href="two-arm-non-inferiority-setting.html#implications-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Allows statements as, for example, <span class="math inline">\(P(RPR&gt; 80\%)\)</span>:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="decomposition-of-ap" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> Decomposition of AP<a href="two-arm-non-inferiority-setting.html#decomposition-of-ap" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>AP integrates over whole <span class="math inline">\(\delta\)</span> range, including â€˜non-favorableâ€™
<span class="math display">\[
AP=\overbrace{P(Z\leq - z_{1-\alpha}, \Delta&gt;\delta^*)}^{(1)}+\overbrace{P(Z\leq - z_{1-\alpha}, 0&lt;\Delta\leq\delta^*)}^{(2)} \\
+\overbrace{P(Z\leq - z_{1-\alpha}, \Delta\leq0)}^{(3)}
\]</span></li>
<li>AP=(1) Probability of Type-I error + (2) â€˜Non-inferior, but treatment effect not relevantâ€™ + (3) â€˜Non-inferior, treatment effect relevantâ€™</li>
<li><span class="math inline">\(AP \approx P(Z\leq - z_{1-\alpha}, \Delta\leq0)\)</span> (see Spiegelhalter), pharma (favors AP, shortterm) vs regulators (favors the other, longterm), see discussion in Kunzmann et al.</li>
</ul>
</div>
<div id="decomposition-of-ap-1" class="section level2 hasAnchor" number="2.9">
<h2><span class="header-section-number">2.9</span> Decomposition of AP<a href="two-arm-non-inferiority-setting.html#decomposition-of-ap-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Under enthusiastic prior:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre><code>##              region    prop
## 1 &#39;Not significant&#39; 0.41627
## 2               (3) 0.49073
## 3               (2) 0.09161
## 4               (1) 0.00139</code></pre>
</div>
<div id="expected-power" class="section level2 hasAnchor" number="2.10">
<h2><span class="header-section-number">2.10</span> Expected power<a href="two-arm-non-inferiority-setting.html#expected-power" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><span class="math display">\[
AP=\overbrace{P(Z\leq - z_{1-\alpha}, \Delta&gt;\delta^*)}^{(1)}+\overbrace{P(Z\leq - z_{1-\alpha}, 0&lt;\Delta\leq\delta^*)}^{(2)} \\
+\overbrace{P(Z\leq - z_{1-\alpha}, \Delta\leq0)}^{(3)}
\]</span>
For our noninferiority setting consider (2)+(3).</p>
<p><span class="math display">\[
P(Z\leq - z_{1-\alpha}, \Delta\leq\delta^*)=P(Z\leq - z_{1-\alpha}|\Delta\leq\delta^*)P(\Delta\leq\delta^*)\\=\underbrace{E\left[P_{\Delta\leq\delta^*}(Z\leq - z_{1-\alpha})\right]}_{EP}P(\Delta\leq\delta^*),
\]</span>
where <span class="math inline">\(EP\)</span> is <strong>â€˜expected powerâ€™</strong> (Kunzmann et al.).</p>
</div>
<div id="to-make-things-more-powerful-confusing" class="section level2 hasAnchor" number="2.11">
<h2><span class="header-section-number">2.11</span> To make things more powerful confusing<a href="two-arm-non-inferiority-setting.html#to-make-things-more-powerful-confusing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Spiegelhalter calls <span class="math inline">\(P(Z\leq - z_{1-\alpha}, \Delta\leq\delta^*)\)</span> the <strong>â€˜prior adjusted powerâ€™</strong> (PAP):</p>
<p><span class="math display">\[
\underbrace{P(Z\leq - z_{1-\alpha}, \Delta\leq\delta^*)}_{PAP}=\underbrace{E\left[P_{\Delta\leq\delta^*}(Z\leq - z_{1-\alpha})\right]}_{EP}\underbrace{P(\Delta\leq\delta^*)}_{constant}
\]</span></p>
</div>
<div id="ep-pap-ap" class="section level2 hasAnchor" number="2.12">
<h2><span class="header-section-number">2.12</span> EP, PAP, AP<a href="two-arm-non-inferiority-setting.html#ep-pap-ap" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Noninferiority setting <span class="math inline">\(\Delta\leq\delta^*\)</span>:</p>
<pre><code>##       ep    pap     ap  const           type
## 1 0.6797 0.3398 0.3418 0.5000      Skeptical
## 2 0.7861 0.5806 0.5828 0.7386   Enthusiastic
## 3 0.7226 0.6454 0.6470 0.8932    Informative
## 4 0.9186 0.5234 0.5233 0.5698 Noninformative</code></pre>
</div>
<div id="conditional-bayesian-power" class="section level2 hasAnchor" number="2.13">
<h2><span class="header-section-number">2.13</span> Conditional Bayesian power<a href="two-arm-non-inferiority-setting.html#conditional-bayesian-power" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Uses posterior distribution to define â€˜Bayesian significanceâ€™: <span class="math inline">\(S^B:=P(\Delta\leq\delta^*|data)=1-\epsilon\)</span>, (not <span class="math inline">\(\alpha\)</span>)
- Remember <span class="math inline">\(D=\overline{Y}_{1}-\overline{Y}_{0}\)</span> with <span class="math inline">\(D \sim N(\delta, \frac{\tilde\sigma^2}{n})\)</span>, where <span class="math inline">\(\tilde\sigma^2=\sigma_1^2+\sigma_1^2\)</span>
Suppose that <span class="math inline">\(\Delta \sim N(d, \tilde\sigma^2/n_0)\)</span> then the posterior distribution given <span class="math inline">\(D\)</span> is distributed as <span class="math inline">\(\Delta|D \sim N\left(\frac{n_0d+nD}{n_0+n}, \frac{\tilde\sigma^2}{n_0+n}\right)\)</span>. We are interested in</p>
<p>$$</p>
<p>$$</p>
<ul>
<li><span class="math inline">\(P(S^B|\delta)=\Phi\left(-\sqrt{\frac{n_0+n}{n}}z_{1-\epsilon}-\frac{\sqrt{n}}{\tilde\sigma}\left[\delta-\frac{n_0+n}{n}\delta^*+\frac{n_0}{n}d\right]\right)\)</span></li>
<li><span class="math inline">\(P(S^{F}|\delta)=\Phi\left(-z_{1-\alpha}-\frac{\sqrt{n}}{\tilde\sigma}(\delta-\delta^*)\right)\)</span></li>
</ul>
</div>
<div id="conditional-bayesian-power-1" class="section level2 hasAnchor" number="2.14">
<h2><span class="header-section-number">2.14</span> Conditional Bayesian power<a href="two-arm-non-inferiority-setting.html#conditional-bayesian-power-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre><code>##   delta    y                type
## 1 0.000 0.83 Bayes: Enthusiastic
## 2 0.035 0.06 Bayes: Enthusiastic
## 3 0.000 0.78    Bayes: Skeptical
## 4 0.035 0.04    Bayes: Skeptical
## 5 0.000 0.80         Frequentist
## 6 0.035 0.05         Frequentist</code></pre>
</div>
<div id="average-bayesian-power" class="section level2 hasAnchor" number="2.15">
<h2><span class="header-section-number">2.15</span> Average Bayesian power<a href="two-arm-non-inferiority-setting.html#average-bayesian-power" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><span class="math inline">\(P(S^B)=\Phi\left(-\sqrt{\frac{n_0}{n}}z_{1-\epsilon}-\frac{\sqrt{n_0}\sqrt{n_0+n}(d-\delta^*)}{\sqrt{n}\tilde\sigma }\right)\)</span></li>
</ul>
<pre><code>##             type    AP AP_bayes
## 1   Enthusiastic 0.583    0.594
## 2      Skeptical 0.341    0.336
## 3    Informative 0.647    0.715
## 4 Noninformative 0.524    0.524</code></pre>
<p>Of course, Bayesian average power can again be decomposed into EP and PAP.</p>
</div>
<div id="power-vocabulary-summary" class="section level2 hasAnchor" number="2.16">
<h2><span class="header-section-number">2.16</span> Power vocabulary summary (ðŸ’ª)<a href="two-arm-non-inferiority-setting.html#power-vocabulary-summary" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>â€˜Powerâ€™: Classical power which is <strong>conditional</strong> on a fixed alternative point estimate. Probability to reject.</li>
<li>Bayesian power: Using posterior distribution.</li>
<li>Conditional power: Frequentist power in interim analysis (not discussed here).</li>
<li>Average power: <strong>Marginal</strong> probability of rejection, classical power â€˜averagedâ€™ over (design) prior. Assurance. Bayesian <strong>predictive</strong> power.</li>
<li>Expected power: Weighted average of the probability to reject in a â€˜relevantâ€™ region. Also called conditional expected power (ðŸ˜•).</li>
<li>Probability of success (PoS): Very often authors use PoS for â€˜average powerâ€™. Depends on success definition.</li>
</ul>
</div>
<div id="from-the-safe-sspe-study-protocol" class="section level2 hasAnchor" number="2.17">
<h2><span class="header-section-number">2.17</span> From the SAFE-SSPE study protocol<a href="two-arm-non-inferiority-setting.html#from-the-safe-sspe-study-protocol" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For sample size calulcation:</p>
<p><em>We used a Monte-Carlo simulation approach based on an Agresti-Caffo confidence interval for risk difference because normal approximation formulas do not hold in case of rare events</em></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-NI.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
